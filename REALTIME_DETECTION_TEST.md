# 실시간 검출 시스템 테스트 가이드

**테스트 일시**: 2025년 10월 31일  
**테스트 범위**: 실시간 검출, 모델 초기화, 바운딩박스 렌더링

---

## 테스트 시나리오

### 시나리오 1: 실시간 검출 시작

**전제 조건**:
- 카메라 권한 허용
- 세트 메타데이터 로드 완료
- 모델 레지스트리에 활성 모델 존재

**예상 동작**:
1. "🎯 실시간 검출 시작" 로그 출력
2. "📹 비디오 크기: 1280x720" 로그 출력
3. "📊 메타데이터: 준비됨" 로그 출력
4. "🎨 바운딩 박스 캔버스: 준비됨" 로그 출력

**검증 포인트**:
- ✅ 모든 초기화 로그 정상 출력
- ✅ 실시간 검출 루프 시작 (100ms 간격)

---

### 시나리오 2: 모델 초기화 (첫 실행)

**예상 동작**:
1. "🔍 실시간 YOLO 검출 시작..." 로그 출력
2. "🔍 YOLO 2단계 검출 시작..." 로그 출력
3. "📊 1단계 검출: Stage1 모델 (빠른 전체 스캔)" 로그 출력
4. "📊 Stage1 실행 프로바이더: WASM (최적화)" 로그 출력
5. "📊 model_registry 활성 모델 조회 성공" 로그 출력
6. "✅ ONNX model_url 사용" 로그 출력
7. "📥 모델 다운로드 시도 1/X" 로그 출력
8. "✅ YOLO 모델 로드 성공" 로그 출력 (다운로드 시간 포함)
9. "📦 모델 바이트 로드 시작..." 로그 출력
10. "✅ 모델 바이트 로드 완료: X bytes" 로그 출력
11. "🔧 ONNX 세션 생성 시작..." 로그 출력
12. "✅ ONNX 세션 생성 완료: Xms" 로그 출력
13. "✅ Stage1 모델 세션 저장 완료 및 사용 가능" 로그 출력
14. "✅ YOLO 모델 초기화 완료 (stage1) (Xms)" 로그 출력

**검증 포인트**:
- ✅ 모델 조회 정상
- ✅ 모델 다운로드 성공
- ✅ ONNX 세션 생성 성공
- ✅ 세션 저장 및 사용 가능 확인

---

### 시나리오 3: 모델 초기화 (재사용)

**예상 동작**:
1. "🔍 실시간 YOLO 검출 시작..." 로그 출력
2. "ℹ️ stage1 모델 세션 이미 로드됨, 재사용" 로그 출력
3. "✅ YOLO 모델 초기화 완료 (stage1) (Xms)" 로그 출력 (빠른 시간)

**검증 포인트**:
- ✅ 세션 재사용 확인
- ✅ 초기화 시간 단축 (재다운로드 없음)

---

### 시나리오 4: 중복 실행 방지

**예상 동작**:
1. 첫 번째 검출 시작
2. 100ms 후 다음 검출 시도
3. "⏳ 검출 진행 중, 이번 프레임 스킵" 로그 출력

**검증 포인트**:
- ✅ 중복 실행 방지
- ✅ 이전 검출 완료 후 다음 검출 시작

---

### 시나리오 5: YOLO 검출 완료 및 바운딩박스 렌더링

**예상 동작**:
1. "🔍 YOLO 검출 시작 (stage1)" 로그 출력
2. "📸 이미지 로드 완료" 로그 출력
3. "🔧 Letterbox 완료" 로그 출력
4. "🔧 입력 텐서 생성" 로그 출력
5. "🚀 YOLO 추론 시작..." 로그 출력
6. "✅ YOLO 추론 완료" 로그 출력
7. "🔍 YOLO 원시 검출: X개" 로그 출력
8. "✅ 실시간 YOLO 검출 완료: X개 객체" 로그 출력
9. "🔍 실시간 검출된 객체: X개" 로그 출력
10. "✅ 레고 부품 검출 성공!" 로그 출력 (검출된 경우)
11. "🎨 polygon_uv 윤곽선 그리기: X개 객체" 로그 출력
12. 화면에 바운딩박스 표시

**검증 포인트**:
- ✅ YOLO 검출 정상 작동
- ✅ 검출 결과 변환 성공
- ✅ 바운딩박스 렌더링 성공
- ✅ 화면에 바운딩박스 표시

---

### 시나리오 6: 검출 결과 없음 처리

**예상 동작**:
1. "❌ 실시간 검출 결과 없음 - 레고 부품이 감지되지 않았습니다" 로그 출력
2. "💡 해결 방법" 로그 출력
3. 바운딩박스 없음 (정상)

**검증 포인트**:
- ✅ 검출 결과 없음 처리 정상
- ✅ 사용자 안내 메시지 출력

---

### 시나리오 7: 모델 로드 실패 처리

**예상 동작**:
1. 모델 다운로드 실패 또는 타임아웃
2. "⚠️ 실시간 YOLO 검출 실패, 휴리스틱 검출로 전환" 로그 출력
3. 휴리스틱 검출로 폴백

**검증 포인트**:
- ✅ 에러 처리 정상
- ✅ 폴백 메커니즘 작동
- ✅ 실시간 검출 중단 없음

---

### 시나리오 8: Promise 캐싱 (동시 초기화)

**예상 동작**:
1. 첫 번째 검출에서 모델 초기화 시작
2. 두 번째 검출에서 "⏳ Stage1 모델 초기화 중... 기존 Promise 재사용 (대기 중)" 로그 출력
3. 첫 번째 초기화 완료 후 두 번째 검출 계속 진행

**검증 포인트**:
- ✅ Promise 재사용 정상
- ✅ 중복 모델 로드 방지
- ✅ 대기 후 정상 완료

---

## 테스트 체크리스트

### 초기화 단계
- [ ] 실시간 검출 시작 로그 확인
- [ ] 비디오 크기 확인
- [ ] 메타데이터 준비 확인
- [ ] 바운딩박스 캔버스 준비 확인

### 모델 로드 단계 (첫 실행)
- [ ] 모델 레지스트리 조회 성공
- [ ] ONNX model_url 사용 확인
- [ ] 모델 다운로드 시도 로그 확인
- [ ] 모델 다운로드 성공 (시간 포함)
- [ ] 모델 바이트 로드 완료
- [ ] ONNX 세션 생성 완료 (시간 포함)
- [ ] 세션 저장 완료

### 모델 재사용 단계
- [ ] 세션 재사용 로그 확인
- [ ] 빠른 초기화 시간 확인

### 검출 단계
- [ ] 중복 실행 방지 확인
- [ ] YOLO 검출 시작/완료 로그
- [ ] 검출 결과 변환 성공
- [ ] 검출 결과 개수 확인

### 렌더링 단계
- [ ] 바운딩박스 그리기 함수 호출
- [ ] polygon_uv 윤곽선 그리기 로그
- [ ] 화면에 바운딩박스 표시 확인

### 에러 처리
- [ ] 모델 로드 실패 시 폴백 확인
- [ ] 에러 발생 시에도 검출 루프 계속 진행

---

## 성능 기준

### 모델 초기화 시간
- **첫 실행**: 3-10초 (모델 다운로드 포함)
- **재사용**: < 10ms (세션 재사용)

### 검출 시간
- **Stage1 검출**: 30-100ms
- **Stage2 검출**: 50-150ms (필요 시)
- **전체 검출**: 50-250ms

### FPS
- **목표**: 10fps (100ms 간격)
- **실제**: 검출 완료 시간에 따라 변동

---

## 알려진 이슈

없음

---

## 개선 사항

1. 모델 다운로드 진행률 표시 (추후 개선)
2. 검출 실패 시 재시도 로직 (추후 개선)
3. 검출 결과 캐싱 (추후 개선)

---

**테스트 완료 후 결과 기록**














