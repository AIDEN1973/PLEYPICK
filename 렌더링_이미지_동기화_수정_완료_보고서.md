# ğŸ”§ ë Œë”ë§ ì´ë¯¸ì§€ Supabase ë²„í‚· ë™ê¸°í™” ë¬¸ì œ í•´ê²° ë³´ê³ ì„œ

## ğŸ“‹ ë¬¸ì œ ìš”ì•½
ë¡œì»¬ì— ë Œë”ë§ëœ ì´ë¯¸ì§€ê°€ Supabase Storage ë²„í‚·ì— ì—…ë¡œë“œë˜ì§€ ì•Šì•„ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì´ë¯¸ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.

---

## ğŸ” ì •ë°€ ë¶„ì„ ê²°ê³¼

### 1ï¸âƒ£ ë²„í‚· ë¶ˆì¼ì¹˜ (ì¹˜ëª…ì  ë¬¸ì œ)
- **ë Œë”ë§ ìŠ¤í¬ë¦½íŠ¸**: `lego-synthetic` ë²„í‚· ì‚¬ìš©
  - ê²½ë¡œ: `synthetic/{element_id}/{uuid}.webp`
  - ìš©ë„: í•©ì„± ë°ì´í„°ì…‹ (AI í•™ìŠµìš©)
  
- **í”„ë¡ íŠ¸ì—”ë“œ**: `lego_parts_images` ë²„í‚· ì‚¬ìš©
  - ê²½ë¡œ: `images/{partNum}_{colorId}.webp`
  - ìš©ë„: ì¼ë°˜ ë¶€í’ˆ ì´ë¯¸ì§€ (UI í‘œì‹œìš©)

### 2ï¸âƒ£ íŒŒì¼ëª… í˜•ì‹ ë¶ˆì¼ì¹˜
- **ë Œë”ë§ ìŠ¤í¬ë¦½íŠ¸**: `{uuid}.webp` (ë¬´ì‘ìœ„ UUID)
- **í”„ë¡ íŠ¸ì—”ë“œ**: `{partNum}_{colorId}.webp` (ë¶€í’ˆë²ˆí˜¸_ìƒ‰ìƒID)

### 3ï¸âƒ£ ìš©ë„ í˜¼ë™
ë Œë”ë§ ìŠ¤í¬ë¦½íŠ¸ê°€ **í•©ì„± ë°ì´í„°ì…‹ ìƒì„± ì „ìš©**ìœ¼ë¡œ ì„¤ê³„ë˜ì–´ ìˆì–´, ì¼ë°˜ ë¶€í’ˆ ì´ë¯¸ì§€ ê´€ë¦¬ ê¸°ëŠ¥ì´ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤.

---

## âœ… í•´ê²° ë°©ì•ˆ

### 1. ìƒˆë¡œìš´ í•¨ìˆ˜ ì¶”ê°€: `upload_part_image_to_storage()`
```python
def upload_part_image_to_storage(self, image_path, part_id, color_id=None):
    """ì¼ë°˜ ë¶€í’ˆ ì´ë¯¸ì§€ë¥¼ lego_parts_images ë²„í‚·ì— ì—…ë¡œë“œ
    - ê²½ë¡œ: images/{part_id}_{color_id}.webp
    - í”„ë¡ íŠ¸ì—”ë“œì™€ í˜¸í™˜ë˜ëŠ” í˜•ì‹ìœ¼ë¡œ ì—…ë¡œë“œ
    - part_images í…Œì´ë¸”ì—ë„ ìë™ ë™ê¸°í™”
    """
```

#### ì£¼ìš” ê¸°ëŠ¥:
1. **ì˜¬ë°”ë¥¸ ë²„í‚· ì‚¬ìš©**: `lego_parts_images`
2. **ì˜¬ë°”ë¥¸ íŒŒì¼ëª…**: `{part_id}_{color_id}.webp`
3. **ì˜¬ë°”ë¥¸ ê²½ë¡œ**: `images/`
4. **DB ìë™ ë™ê¸°í™”**: `part_images` í…Œì´ë¸”ì— ë©”íƒ€ë°ì´í„° ì €ì¥

### 2. ë Œë”ë§ í”Œë¡œìš° ìˆ˜ì •
```python
# 16. Supabase ì—…ë¡œë“œ
# í•©ì„± ë°ì´í„°ì…‹ìš©ê³¼ ì¼ë°˜ ë¶€í’ˆ ì´ë¯¸ì§€ìš© ëª¨ë‘ ì—…ë¡œë“œ
urls = self.upload_to_supabase(image_path, annotation_path, part_id, metadata)

# 16.5. ì¼ë°˜ ë¶€í’ˆ ì´ë¯¸ì§€ë¡œë„ ì—…ë¡œë“œ (í”„ë¡ íŠ¸ì—”ë“œ í˜¸í™˜)
color_id = metadata.get('material', {}).get('color_id', 0)
part_image_result = self.upload_part_image_to_storage(image_path, part_id, color_id)
if part_image_result:
    print(f"âœ… ë¶€í’ˆ ì´ë¯¸ì§€ ë™ê¸°í™” ì™„ë£Œ: {part_image_result['url']}")
```

### 3. ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ ì œê³µ
ê¸°ì¡´ì— ë¡œì»¬ì—ë§Œ ì €ì¥ëœ ì´ë¯¸ì§€ë¥¼ ì¼ê´„ ì—…ë¡œë“œí•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì œê³µí•©ë‹ˆë‹¤:
```bash
python scripts/migrate_local_images_to_supabase.py --output-dir ./output/synthetic
```

---

## ğŸ”„ ì—…ë¡œë“œ í”Œë¡œìš° ë¹„êµ

### âŒ ì´ì „ (ë¬¸ì œ)
```
ë Œë”ë§ â†’ ë¡œì»¬ ì €ì¥ â†’ lego-synthetic ë²„í‚·
                      (synthetic/{uuid}.webp)
                      â†“
                   í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì°¾ì„ ìˆ˜ ì—†ìŒ
                   (lego_parts_images ë²„í‚·ì˜ images/{partNum}_{colorId}.webp ì°¾ìŒ)
```

### âœ… ìˆ˜ì • í›„
```
ë Œë”ë§ â†’ ë¡œì»¬ ì €ì¥ â†’ 1) lego-synthetic ë²„í‚· (í•©ì„± ë°ì´í„°ì…‹)
                      (synthetic/{uuid}.webp)
                  â†’ 2) lego_parts_images ë²„í‚· (ì¼ë°˜ ë¶€í’ˆ ì´ë¯¸ì§€)
                      (images/{partNum}_{colorId}.webp)
                      + part_images í…Œì´ë¸” ë™ê¸°í™”
                      â†“
                   í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì •ìƒ í‘œì‹œ
```

---

## ğŸ“ ìˆ˜ì •ëœ íŒŒì¼

### 1. `scripts/render_ldraw_to_supabase.py`
- **ìƒˆë¡œìš´ í•¨ìˆ˜ ì¶”ê°€**: `upload_part_image_to_storage()`
- **ë Œë”ë§ í”Œë¡œìš° ìˆ˜ì •**: ì´ì¤‘ ì—…ë¡œë“œ (í•©ì„± ë°ì´í„°ì…‹ + ì¼ë°˜ ë¶€í’ˆ ì´ë¯¸ì§€)
- **DB ë™ê¸°í™” ì¶”ê°€**: `part_images` í…Œì´ë¸” ìë™ ì—…ë°ì´íŠ¸

### 2. `scripts/migrate_local_images_to_supabase.py` (ì‹ ê·œ)
- ê¸°ì¡´ ë¡œì»¬ ì´ë¯¸ì§€ë¥¼ Supabaseë¡œ ì¼ê´„ ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸
- Dry-run ëª¨ë“œ ì§€ì›

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ë°©ë²•

### 1. ìƒˆë¡œìš´ ì´ë¯¸ì§€ ë Œë”ë§ í…ŒìŠ¤íŠ¸
```bash
# ë¶€í’ˆ 3001ì„ ë¹¨ê°„ìƒ‰(color_id=4)ìœ¼ë¡œ ë Œë”ë§
blender --background --python scripts/render_ldraw_to_supabase.py -- \
  --part-id 3001 \
  --count 1 \
  --color-id 4 \
  --output-dir ./output/test
```

**í™•ì¸ ì‚¬í•­**:
1. ì½˜ì†”ì— "âœ… ë¶€í’ˆ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì™„ë£Œ" ë©”ì‹œì§€ í™•ì¸
2. Supabase Storage â†’ `lego_parts_images` ë²„í‚· â†’ `images/3001_4.webp` ì¡´ì¬ í™•ì¸
3. `part_images` í…Œì´ë¸”ì—ì„œ `part_id=3001, color_id=4` ë ˆì½”ë“œ í™•ì¸
4. í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì´ë¯¸ì§€ ì •ìƒ í‘œì‹œ í™•ì¸

### 2. ê¸°ì¡´ ì´ë¯¸ì§€ ë§ˆì´ê·¸ë ˆì´ì…˜ í…ŒìŠ¤íŠ¸
```bash
# Dry-run ëª¨ë“œë¡œ ì‹œë®¬ë ˆì´ì…˜
python scripts/migrate_local_images_to_supabase.py \
  --output-dir ./output/synthetic \
  --dry-run

# ì‹¤ì œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
python scripts/migrate_local_images_to_supabase.py \
  --output-dir ./output/synthetic
```

---

## ğŸ¯ í•µì‹¬ ê°œì„  ì‚¬í•­

### 1. **ì´ì¤‘ ì €ì¥ ì „ëµ**
- í•©ì„± ë°ì´í„°ì…‹: `lego-synthetic` ë²„í‚· (AI í•™ìŠµìš©)
- ì¼ë°˜ ì´ë¯¸ì§€: `lego_parts_images` ë²„í‚· (UI í‘œì‹œìš©)

### 2. **ìë™ ë™ê¸°í™”**
- Storage ì—…ë¡œë“œ ì‹œ `part_images` í…Œì´ë¸”ì— ìë™ìœ¼ë¡œ ë©”íƒ€ë°ì´í„° ì €ì¥
- í”„ë¡ íŠ¸ì—”ë“œê°€ DB ì¿¼ë¦¬ë¡œ ì´ë¯¸ì§€ë¥¼ ë¹ ë¥´ê²Œ ì°¾ì„ ìˆ˜ ìˆìŒ

### 3. **í•˜ìœ„ í˜¸í™˜ì„±**
- ê¸°ì¡´ í•©ì„± ë°ì´í„°ì…‹ ìƒì„± ê¸°ëŠ¥ì€ ê·¸ëŒ€ë¡œ ìœ ì§€
- ìƒˆë¡œìš´ ê¸°ëŠ¥ì´ ì¶”ê°€ë¡œ ë™ì‘

### 4. **ë§ˆì´ê·¸ë ˆì´ì…˜ ì§€ì›**
- ê³¼ê±°ì— ë¡œì»¬ì—ë§Œ ì €ì¥ëœ ì´ë¯¸ì§€ë¥¼ ì¼ê´„ ì—…ë¡œë“œ ê°€ëŠ¥

---

## ğŸ”’ ì£¼ì˜ì‚¬í•­

### 1. í™˜ê²½ ë³€ìˆ˜ í•„ìˆ˜
`.env.blender` íŒŒì¼ì— Supabase ì¸ì¦ ì •ë³´ í•„ìš”:
```env
VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key
```

### 2. ë²„í‚· ê¶Œí•œ í™•ì¸
- `lego_parts_images` ë²„í‚·ì´ ì¡´ì¬í•˜ê³  public ì ‘ê·¼ ê°€ëŠ¥í•´ì•¼ í•¨
- Supabase ëŒ€ì‹œë³´ë“œì—ì„œ ë²„í‚· ì •ì±… í™•ì¸

### 3. ì¤‘ë³µ ì²˜ë¦¬
- `upsert: true` ì˜µì…˜ìœ¼ë¡œ ë™ì¼ íŒŒì¼ ë®ì–´ì“°ê¸°
- ì¬ë Œë”ë§ ì‹œ ê¸°ì¡´ ì´ë¯¸ì§€ ìë™ êµì²´

---

## ğŸ“Š ì˜ˆìƒ íš¨ê³¼

### âœ… ë¬¸ì œ í•´ê²°
- âœ… ë¡œì»¬ ë Œë”ë§ ì´ë¯¸ì§€ê°€ Supabaseì— ìë™ ì—…ë¡œë“œ
- âœ… í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì´ë¯¸ì§€ ì •ìƒ í‘œì‹œ
- âœ… ì´ë¯¸ì§€ ì¤‘ë³µ ê²€ì‚¬ ì •ìƒ ë™ì‘
- âœ… ì´ë¯¸ì§€ ìºì‹œ ì •ìƒ ë™ì‘

### ğŸ“ˆ ì„±ëŠ¥ ê°œì„ 
- DB ì¿¼ë¦¬ë¡œ ì´ë¯¸ì§€ ì¡´ì¬ ì—¬ë¶€ ë¹ ë¥´ê²Œ í™•ì¸
- Storage HEAD ìš”ì²­ ìµœì†Œí™”

### ğŸ”§ ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ
- ëª…í™•í•œ ë²„í‚· ìš©ë„ êµ¬ë¶„
- ì¼ê´€ëœ íŒŒì¼ëª… ê·œì¹™

---

## ğŸš€ ë°°í¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] ë Œë”ë§ ìŠ¤í¬ë¦½íŠ¸ ìˆ˜ì •
- [x] ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±
- [x] ë¬¸ì„œ ì‘ì„±
- [ ] í…ŒìŠ¤íŠ¸ ì‹¤í–‰ (ì‚¬ìš©ì í™•ì¸ í•„ìš”)
- [ ] ê¸°ì¡´ ë¡œì»¬ ì´ë¯¸ì§€ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
- [ ] í”„ë¡ íŠ¸ì—”ë“œ ë™ì‘ í™•ì¸

---

## ğŸ“ ë‹¤ìŒ ë‹¨ê³„

1. **í…ŒìŠ¤íŠ¸ ì‹¤í–‰**: ìœ„ì˜ í…ŒìŠ¤íŠ¸ ë°©ë²•ì— ë”°ë¼ ê²€ì¦
2. **ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰**: ê¸°ì¡´ ë¡œì»¬ ì´ë¯¸ì§€ë¥¼ Supabaseë¡œ ì—…ë¡œë“œ
3. **ëª¨ë‹ˆí„°ë§**: í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì´ë¯¸ì§€ ì •ìƒ í‘œì‹œ ì—¬ë¶€ í™•ì¸
4. **ë¬¸ì„œ ì—…ë°ì´íŠ¸**: ìš´ì˜ ê°€ì´ë“œì— ìƒˆë¡œìš´ ì—…ë¡œë“œ í”Œë¡œìš° ì¶”ê°€

---

**ì‘ì„±ì¼**: 2025-10-19
**ì‘ì„±ì**: AI Assistant
**ë¬¸ì„œ ë²„ì „**: 1.0

