# BrickBox ìš´ì˜í˜• ìµœì¢… ê²°ë¡  ê¸°ìˆ ë¬¸ì„œ

ğŸ§± BrickBox ìš´ì˜í˜• ìµœì¢… ê²°ë¡  ê¸°ìˆ ë¬¸ì„œ (WebP ë°˜ì˜íŒ Â· Complete)

ë²„ì „: 1.3 (2025-10-30)
ì ìš©ëŒ€ìƒ: ì„¸íŠ¸ë³„ íì‡„ í™˜ê²½ Â· ì‹¤ì‚¬ 0ì¥ Â· ë¶€í’ˆë‹¹ WebP ë Œë”ë§ 200ì¥ Â· ì„¸íŠ¸ë‹¹ ìµœëŒ€ 4,000 ë¶€í’ˆ(ìˆ˜ëŸ‰ ê¸°ì¤€; ê³ ìœ  íŒŒì¸  ê¸°ì¤€ìœ¼ë¡  ìˆ˜ë°±~ì²œ ë‹¨ìœ„)
ìš”ì•½: YOLO 1-class segë¡œ íƒì§€ ì „ë‹´, CLIP/FGC ì„ë² ë”© + FAISS Two-Stage + Adaptive Fusionìœ¼ë¡œ ì‹ë³„ ì „ë‹´, **BOM ì œì•½ + í—ê°€ë¦¬ì•ˆ(ê³„ì¸µ/í¬ì†Œ/ë¹„ë™ê¸°)**ìœ¼ë¡œ ì¤‘ë³µÂ·ì´ˆê³¼ ì°¨ë‹¨, WebP ì „ìš© ì •ì±…ìœ¼ë¡œ ì„±ëŠ¥Â·ìš©ëŸ‰ ë™ì‹œ ë‹¬ì„±, **ë‹¨ìˆœí™”ëœ ì ì‘í˜• ìƒ˜í”Œë§**ìœ¼ë¡œ ì•ˆì •ì„± í–¥ìƒ

1. ëª©ì  Â· ë²”ìœ„ Â· SLO
ëª©ì 

WebP ê¸°ë°˜ í•©ì„± ë°ì´í„°ì™€ AI ë©”íƒ€ë¥¼ í™œìš©í•˜ì—¬ ì‹¤ì‹œê°„ ëˆ„ë½ ë¶€í’ˆ ê²€ì¶œì„ ì•ˆì •ì ìœ¼ë¡œ ë‹¬ì„±í•˜ëŠ” ì¢…ë‹¨ íŒŒì´í”„ë¼ì¸ ì •ì˜.

ë²”ìœ„

ë°ì´í„° ë ˆì´ì•„ì›ƒ/ë¶„í• /ì¤‘ë³µ ë°©ì§€/QA, WebP ì •ì±…/ìºì‹œ

íƒì§€(Detector) â†” ì‹ë³„(Identifier) ì™„ì „ ë¶„ë¦¬

ì„ë² ë”© ê²€ìƒ‰: FAISS(HNSW) Two-Stage (+ confusions aware)

Adaptive Feature Fusion(img/meta/txt + topo/area ë³´ì •)

BOM ì œì•½ + í—ê°€ë¦¬ì•ˆ(ê³„ì¸µ/í¬ì†Œ/ë¹„ë™ê¸°, ì‹±ê¸€ ë¼ì´í„° ë³´ì¥)

ëª¨ë‹ˆí„°ë§/ì•Œë¦¼/ëŸ°ë¶, ë³´ì•ˆÂ·ë³€ê²½ê´€ë¦¬, ê²€ì¦/A/B ì¸ìˆ˜ ê¸°ì¤€

í™•ì¥: í•˜ë“œ í…œí”Œë¦¿, L1/L2 ì¸ë±ìŠ¤, FGC-Encoder ì „í™˜

ìš´ì˜ SLO
í•­ëª©	ëª©í‘œ
íƒì§€ Recall(ì†Œí˜• í¬í•¨)	â‰¥ 0.95
ì‹ë³„ Top-1@BOM	â‰¥ 0.97
ì˜¤ê²€ì¶œë¥ 	â‰¤ 3%
ë³´ë¥˜ìœ¨	â‰¤ 5%
í‰ê·  ì§€ì—°	100â€“150 ms/frame (ì¤‘ê¸‰ GPU, íƒ€ì¼ë§ í¬í•¨)
WebP ë””ì½”ë”© p95	â‰¤ 15 ms/frame
ì¸ë±ìŠ¤ ê²€ìƒ‰ p95	â‰¤ 10 ms (Stage-1), â‰¤ 15 ms (Stage-2)

1. ì‹œìŠ¤í…œ ìƒìœ„ ì•„í‚¤í…ì²˜
ì…ë ¥(WebP í”„ë ˆì„)
â””â”€ YOLO(1-class seg, @768/960) â†’ bbox+mask
â””â”€ tight-crop(ë§ˆìŠ¤í¬ ì •ê·œí™”, íŒ¨ë”© ê·œì¹™)
â””â”€ ì„ë² ë”© ì¶”ì¶œ: CLIP(ìš´ì˜ ê¸°ë³¸) / FGC(ì—°êµ¬Â·ë³´ì¡°)
â””â”€ FAISS(HNSW) ê²€ìƒ‰: BOM ì„œë¸Œì…‹ (Two-Stage: Top-5 â†’ í•„ìš”ì‹œ Top-10/ef=160)
â””â”€ Adaptive Fusion(img/meta/txt + topo_penalty + area_consistency)
â””â”€ BOM ì œì•½ + í—ê°€ë¦¬ì•ˆ(ê³„ì¸µÂ·í¬ì†ŒÂ·ë¹„ë™ê¸° / ì‹±ê¸€ ë¼ì´í„° ë³‘í•©)
â””â”€ ëˆ„ë½/ì´ˆê³¼ ì‚°ì¶œ + ë³´ë¥˜ í ì¬í‰ê°€

í•µì‹¬ ì„¤ê³„ ì² í•™

Detection is not Identification. (íƒì§€/ì‹ë³„ ì™„ì „ ë¶„ë¦¬)

Closed-World by BOM. (BOM ì œì•½ + Hungarian)

Search small, adaptively. (Two-Stage + Fusion ë™ì  ê°€ì¤‘)

Compress smart. (WebP q=90 + SSIM 0.965)

1. ë°ì´í„° ì •ì±… (WebP)
2.1 ì„¸íŠ¸ ë‹¨ìœ„ ë””ë ‰í† ë¦¬Â·ë©”íƒ€ êµ¬ì¡°
/dataset_{SET_ID}/
images/train|val|test/{element_id}/{uuid}.webp
labels/ # YOLO seg labels (txt/poly)
masks_bin/ (ì„ íƒ, PNG) # ë°”ì´ë„ˆë¦¬ ë§ˆìŠ¤í¬ (í’ˆì§ˆ ì ê²€/ì—°êµ¬)
meta/
renders.jsonl # {set_id, element_id, render_id, seed, pose, light, domain, dup_of?}
ai_meta.jsonl # 7.1 ìŠ¤í‚¤ë§ˆ ì¤€ìˆ˜
faiss_index/ # ì¸ë±ìŠ¤ + ë²„ì „ íƒœê·¸ (L1/L2 êµ¬ë¶„ ê°€ëŠ¥)

2.2 ë¶„í• (ëˆ„ìˆ˜ ë°©ì§€)

(seed, pose, light) ì¡°í•© ë‹¨ìœ„ë¡œ Train/Val/Test ë¶„ë¦¬(ë™ì¼ ì¡°í•© cross-split ê¸ˆì§€).

ê¸°ë³¸ 80/10/10. domain=original|rdaX íƒœê¹…(RDA ê°•ë„ ê¸°ë¡; ë¶„í•  ê¸°ì¤€ X).

2.3 ì¤‘ë³µ ì œê±°(ì†ì‹¤ ì••ì¶• ë³´ì •)

3ë‹¨ê³„: pHash â†’ SSIM â†’ CLIP cos.

WebP lossy(qâ‰ˆ90) ì‚¬ìš© ì‹œ SSIM ì„ê³„ 0.965(ê¸°ë³¸ 0.97ì—ì„œ ë³´ì •).

ë™ì¼ (seed,pose,light)ëŠ” ë©”íƒ€ ê¸°ë°˜ ì¦‰ì‹œ ì¤‘ë³µ. renders.jsonl.dup_of ê¸°ë¡ â†’ ì¬í›ˆë ¨/ì¬ì¸ë±ì‹± ì°¨ë‹¨.

2.4 WebP ì¸ì½”ë”©Â·ë§ˆìŠ¤í¬ ì •ì±…

í•™ìŠµ ì´ë¯¸ì§€: WebP lossy q=90, -m 6, -af on, sRGB(ICC ìœ ì§€)

í…œí”Œë¦¿/í•˜ë“œ í…œí”Œë¦¿: lossless ê¶Œì¥(ëŒ€ì•ˆ: q=95 + ì„ê³„ ë³´ì •)

ë§ˆìŠ¤í¬/ë¼ë²¨: ì†ì‹¤ ì••ì¶• ê¸ˆì§€(í…ìŠ¤íŠ¸ í´ë¦¬ê³¤ or PNG)

2.5 WebP ë””ì½”ë”© ì„±ëŠ¥(ìºì‹œ/í”„ë¦¬íŒ¨ì¹˜)

DataLoader(num_workers=8~12, prefetch_factor=2~4, pin_memory=True)

Tensor LRU ìºì‹œ(ìµœì†Œ 5,000ì¥ â‰ˆ ~4GB) + ë¹„ë™ê¸° ë””ì½”ë”© í’€

íš¨ê³¼: í•™ìŠµ ìŠ¤ë£¨í’‹ +20~30%, GPU idle ê°ì†Œ, ë””ì½”ë”© p95 â‰¤ 15 ms ìœ ì§€

1. ë°ì´í„° í’ˆì§ˆ Â· QA
3.1 ë¼ë²¨/ë§ˆìŠ¤í¬ QA ê·œì¹™

mask ë©´ì  / bbox ë©´ì : 25~98% ë²”ìœ„ë¥¼ ë²—ì–´ë‚˜ë©´ í”Œë˜ê·¸

Topology: hole count Z-score > |3| â†’ ë¦¬ë·° í

EarlyStopping: 15 epoch ë‚´ mAP ê°œì„  < 0.1% â†’ ì¡°ê¸° ì¢…ë£Œ

3.2 RDA(Render Domain Randomization)

Train **80%**ì— ì¡°ëª…/HDR/ìŠ¤í¬ë˜ì¹˜/ë°°ê²½/ë Œì¦ˆì™œê³¡.

Val/TestëŠ” ì›ë³¸ ì¤‘ì‹¬(ì¼ë°˜í™” í‰ê°€).

3.3 AI ë©”íƒ€ DB ë™ê¸°í™”(ìë™ ë§¤í•‘) - v2.1 ì—…ë°ì´íŠ¸
JSONL í‚¤	DB í•„ë“œ(parts_master_features)	ë§¤í•‘ ë°©ì‹
shape_tag	shape_tag (VARCHAR)	ì§ì ‘ ì €ì¥
shape_tag	part_category (INTEGER)	Enum ì°¸ì¡° (part_categories í…Œì´ë¸”)
series	series (VARCHAR)	ì§ì ‘ ì €ì¥ (system/duplo/technic/bionicle)
stud_count_top	expected_stud_count	ì§ì ‘ ë§¤í•‘
tube_count_bottom	expected_hole_count	ì§ì ‘ ë§¤í•‘
groove, center_stud	groove, center_stud	ì§ì ‘ ë§¤í•‘
confusions	confusion_groups	ì§ì ‘ ë§¤í•‘
distinguishing_features	distinguishing_features	ì§ì ‘ ë§¤í•‘
recognition_hints	recognition_hints	ì§ì ‘ ë§¤í•‘
topo_applicable	meta_penalty	í”Œë˜ê·¸ ë³€í™˜
image_quality.*	image_quality_q/snr	ì§‘ê³„ ë³€í™˜

v2.1 ì£¼ìš” ë³€ê²½ì‚¬í•­:
- shape_tagì™€ series ì—­í•  ë¶„ë¦¬ (í˜•íƒœ vs ì‹œë¦¬ì¦ˆ)
- part_category: Enum í…Œì´ë¸” ê¸°ë°˜ ë™ì  ë§¤í•‘ (í™•ì¥ ê°€ëŠ¥)
- ì¹´í…Œê³ ë¦¬ ë²”ìœ„: 1-99 (ê¸°ì¡´ 0-7 ì œí•œ í•´ì œ)
- ì¹´í…Œê³ ë¦¬ ì¢…ë¥˜: 30+ê°œ ì§€ì› (plate, brick, tile, slope, panel, wedge, cylinder, cone, arch, round, dish, hinge, clip, bar, fence, door, window, roof, inverted, minifig_part, animal_figure, plant_leaf, wheel, tire, wing, propeller, gear, chain, axle, unknown)

ì—…ì„œíŠ¸ ë°°ì¹˜ ì‹œ version ì¦ê°€, operation_logs.metadataì— ë³€ê²½ ì´ë ¥ ì €ì¥.

1. íƒì§€(Detector) â€” YOLO 1-class Segmentation
4.1 ëª¨ë¸ ì„ íƒ

ê¸°ë³¸: YOLO11m-seg @768

ë²¤ì¹˜: 11m-seg@768 vs YOLOv8-L-seg@768 (ëŒ€í‘œ ì„¸íŠ¸ 3ì¢… Ã— 500í”„ë ˆì„)

ì†Œí˜• Recall â‰¥ 0.95 and FPS â‰¥ 5 â†’ ì±„íƒ

ë¯¸ë‹¬ ì‹œ 960 ì¬ë²¤ì¹˜ â†’ ë¯¸ë‹¬ ì‹œ v8-L-seg ìŠ¹ê¸‰

4.2 í•™ìŠµ/ì¶”ë¡  ê¸°ë³¸ê°’

í•™ìŠµ: epochs=100 (ES=15), batch=16~32, copy_paste=0.6, mosaic=0.5, fliplr=0.5, hsv=(0.7,0.4,0.4), perspective=0.001, erasing=0.2, AdamW + cosine LR

ì¶”ë¡ : conf=0.15, iou=0.60, max_det=1200, imgsz=768

ë°€ì§‘ í”„ë ˆì„: 2Ã—2 íƒ€ì¼ë§(overlap 15%) ìë™ ìŠ¤ìœ„ì¹˜

ì¶œë ¥: bbox + mask â†’ tight-crop í’ˆì§ˆ ê²°ì •(íŒ¨ë”©=mask ì™¸ê³½ 4~8px ê¶Œì¥)

1. ì‹ë³„(Identifier) â€” ì„ë² ë”© ê²€ìƒ‰ + Adaptive Fusion
5.1 FAISS ê²€ìƒ‰ (Two-Stage)

ì¸ë±ìŠ¤: BOM ì„œë¸Œì…‹(í´ë˜ìŠ¤ë‹¹ ëŒ€í‘œ 10~20 + Hard 5)

Stage-1: Top-5 (ef=128)

Stage-2: confusionsì— í¬í•¨ëœ ìœ ì‚¬ íŒŒì¸ ê°€ Top-5ì— ì—†ìœ¼ë©´ Top-10(ef=160) ì¬ê²€ìƒ‰

ì¸ë±ìŠ¤ ê´€ë¦¬: 2ì£¼ ì£¼ê¸° full rebuild(íŒŒí¸í™” ë°©ì§€), Hard í…œí”Œë¦¿ ìë™ ì„ ë³„(misclass_rate>5% or hold>10%)

5.2 Adaptive Feature Fusion(ë™ì  ê°€ì¤‘)
sim_final =
w_img  * cos(emb_img,  tmpl_img)

- w_meta * cos(emb_meta, tmpl_meta)
- w_txt * cos(emb_txt, tmpl_txt)
- topo_penalty(query_mask, meta)
- area_bonus(query_mask, cls_stats)

ì´ˆê¸°ê°’: w_img=0.65, w_meta=0.25, w_txt=0.15

íƒ€ì¼/í”„ë¦°íŠ¸ ìœ„ì£¼(stud_count_topâ‰¤1â‰¥40%): w_meta=0.20, w_txt=0.20

ìŠ¤í„°ë“œ/íŠœë¸Œ ëšœë ·(stud_count_topâ‰¥2â‰¥70%): w_meta=0.30, w_txt=0.10

ì„¸íŠ¸ ê·œëª¨ ë³´ì •: ë¶€í’ˆ>2,000 â†’ w_txt += 0.05(â‰¤0.20) / ë¶€í’ˆ<200 â†’ w_txt -= 0.05(â‰¥0.10)

ìë™ íŠœë‹(24h ë¡¤ë§): ì˜¤ê²€ì¶œ>3% â†’ w_meta/txt += 0.05(ìƒí•œ ì¤€ìˆ˜) / ë³´ë¥˜>7% â†’ Hard í…œí”Œë¦¿ +3/cls, w_img += 0.05(â‰¤0.70)

5.3 topo_penalty & area_consistency

topo_applicable=trueì¸ íŒŒì¸ ì—ì„œ ìƒë©´ êµ¬ë© ìˆ˜ vs í•˜ë¶€ íŠœë¸Œ ìˆ˜ ë¹„êµ

ì°¨ì´ 0 â†’ 0 / ì°¨ì´ 1 â†’ -0.03 / ì°¨ì´ â‰¥2 â†’ -0.06~-0.08

area_consistency: ì˜ˆìƒ ë©´ì  Â±30% ì´ë‚´ë©´ +0.10 ë³´ë„ˆìŠ¤

5.4 í…ìŠ¤íŠ¸ í’ˆì§ˆÂ·ì–¸ì–´ ëŒ€ì‘(ë‹¤êµ­ì–´)

lang_aware_keyword_score + noun_densityë¡œ í’ˆì§ˆ ì ìˆ˜(0~1) â†’ w_txt ì´ˆê¸°í™”(0.05/0.10/0.15)

ì§€ì› ì–¸ì–´(ì´ˆê¸° 4ê°œ â†’ í™•ì¥ ë¡œë“œë§µ): en/ko/ja/de

1. DB ìŠ¤í‚¤ë§ˆ ë§¤í•‘(í•µì‹¬ í…Œì´ë¸”)
ëª©ì 	í…Œì´ë¸”	ì£¼ìš” í•„ë“œ(ì˜ˆ)
íŒŒì¸  ë©”íƒ€/ì„ë² ë”©/í˜¼ë™	parts_master_features	feature_json, feature_text, clip_text_emb, recognition_hints, confusion_groups, expected_stud_count/hole_count, image_quality_q, tier, score_*
í•©ì„± ë°ì´í„°/ë ˆì´ë¸”	synthetic_dataset / synthetic_part_stats	image_path/url, annotation_path/url, metadata, total_images, angle/color/background dist
ë Œë”ë§ ì„¤ì •	synthetic_render_configs	render_settings, material/lighting/background
ì„¸íŠ¸/BOM	lego_sets, set_parts	set_num, element_id, quantity, is_spare
ëª¨ë¸/ë²„ì „/ì¸ë±ìŠ¤	model_registry, active_models	model_version/type/path, dataset_id, performance_metrics, is_active
í•™ìŠµ ì¡/ë©”íŠ¸ë¦­	training_jobs, training_metrics, training_job_stats	config/progress/metrics, duration, started/completed_at
ìš´ì˜ ë¡œê·¸/ì•Œë¦¼	operation_logs, automation_config, auto_training_stats	operation_type, status, metadata(jsonb); ê²½ë³´/íŠœë‹ ê¸°ë¡

ì¸ë±ìŠ¤ íŒŒì¼ì€ Storageì— ë³´ê´€, model_registry.metrics.index_manifestë¡œ í•´ì‹œÂ·ê²½ë¡œ ê´€ë¦¬ ê¶Œì¥.


1. BOM ì œì•½ + í—ê°€ë¦¬ì•ˆ (ê³„ì¸µ/í¬ì†Œ/ë¹„ë™ê¸°)
7.1 ë¹„ìš©/ì„ê³„

ë¹„ìš© = âˆ’sim_final, í™•ì • ì„ê³„ 0.80, ë³´ë¥˜: sim_final < 0.80 ë˜ëŠ” Top1â€“Top2 < 0.10

7.2 í¬ì†Œí™”/ê³„ì¸µ ì²˜ë¦¬

Pre-filter: ê° íƒì§€ Top-3 í›„ë³´(ë˜ëŠ” sim_final â‰¥ 0.50)ë§Œ ë¹„ìš© í–‰ë ¬ í¬í•¨

ê³„ì¸µ:

ê³ í™•ì‹  >0.90: ì¦‰ì‹œ í• ë‹¹(greedy)

ì¤‘ê°„ 0.70~0.90: ë°°ì¹˜ í—ê°€ë¦¬ì•ˆ(ì˜ˆ: 100ê°œì”©)

ì €í™•ì‹  â‰¤0.70: ë³´ë¥˜/íœ´ë¦¬ìŠ¤í‹±

ì¸ì ‘ ì–µì œ: ì„¼íŠ¸ë¡œì´ë“œ ê±°ë¦¬ < min_sizeÃ—0.5 â†’ ë‚®ì€ ì ìˆ˜ ì œê±°

7.3 ë¹„ë™ê¸° ìŠ¤ì¼€ì¤„ëŸ¬(Option A: ìŠ¤ëƒ…ìƒ·+ë‹¨ì¼ ë³‘í•©ì)

íƒì§€/ì‹ë³„ê³¼ í—ê°€ë¦¬ì•ˆ ì™„ì „ ë¶„ë¦¬.

í”„ë ˆì„ë³„ BOM ìŠ¤ëƒ…ìƒ· ì „ë‹¬ â†’ ê²°ê³¼ë§Œ ì‹±ê¸€ ë¼ì´í„°ê°€ ë³‘í•©, ìŒìˆ˜ ë°©ì§€ ê²€ì¦.

í ê¹Šì´>10 â†’ sync í´ë°±. íƒ€ì„ì•„ì›ƒ 500ms â†’ greedy í´ë°± + ê²½ë³´.

1. í•˜ë“œ í…œí”Œë¦¿(L2) Â· ì¸ë±ìŠ¤ ìš´ì˜
8.1 ì¶”ê°€Â·ê°±ì‹ 

ìë™ ì„ ë³„: misclass_rate > 5% or hold_rate > 10% â†’ Hard +3~5/cls

L1/L2 ê³„ì¸µ ì¸ë±ìŠ¤: L1(ëŒ€í‘œ) ë©”ëª¨ë¦¬ ìƒì£¼, L2(í•˜ë“œ) mmap(SSD). ì½œë“œ ìŠ¤íƒ€íŠ¸ +5~10ms.

8.2 Pruning(3ë‹¨ê³„, 6ê°œì›” ì£¼ê¸°)

Tier 1 (ì¦‰ì‹œ ì œê±°): hit_rate < 0.01 or success_rate < 0.05

Tier 2 (ê²€í† ): hit_rate < 0.05 and success_rate < 0.10 (A/B í›„ ê²°ì •)

Tier 3 (ìœ ì§€): ê¸°íƒ€

Pruning ì „ Î”Top-1 < 0.1%p ê²€ì¦ í•„ìˆ˜, ìµœì†Œ ìœ ì§€ 15ì¥/í´ë˜ìŠ¤.

1. FGC-Encoder (ArcFace) â€” ì—°êµ¬â†’ìš´ì˜ ì „í™˜
9.1 ì „í™˜ ì •ëŸ‰ ê¸°ì¤€

Top-1 +1.5%p ì´ìƒ, p95 ì§€ì—° â‰¤ 1.3Ã—, ê²€ì¦ ìƒ˜í”Œ â‰¥ 10,000, 95% CI í†µê³¼

9.2 Adaptive Ensemble(ë§ˆì§„ ê¸°ë°˜)

margin = sim_top1 âˆ’ sim_top2 ì‘ì„ìˆ˜ë¡ FGC ê°€ì¤‘â†‘

ê¸°ë³¸ì‹: w_fgc = clamp(0.3 + (0.2 - margin)*1.2, 0.3, 0.7)

A/B ìº˜ë¦¬ë¸Œë ˆì´ì…˜: slopeâˆˆ{1.0,1.2,1.5}, pivotâˆˆ{0.15,0.20,0.25} â†’ model_registry.performance_metrics.fgc_margin_curve ê¸°ë¡

1. ì„±ëŠ¥ Â· ìš©ëŸ‰ Â· ìì› ê°€ì´ë“œ
10.1 ì§€ì—° êµ¬ì„±(ì¤‘ê¸‰ GPU ê¸°ì¤€)

íƒì§€(11m-seg@768): 25~40ms (íƒ€ì¼ 2Ã—2 â†’ 100~160ms)

ì„ë² ë”©: 300~800 í¬ë¡­/í”„ë ˆì„, ë°°ì¹˜ 64/128 â†’ 20~60ms

ê²€ìƒ‰: FAISS Top-5(â†’Top-10) â†’ <10ms (Stage-2 ì§„ì… 10~25%)

ì´í•©: ë¬´íƒ€ì¼ 60~130ms / íƒ€ì¼ 120~200ms

10.2 ë©”ëª¨ë¦¬/ìŠ¤í† ë¦¬ì§€

ì¸ë±ìŠ¤ RAM: 2,000 cls Ã— 15 tmpl Ã— 512 dim Ã— float32(4B) â‰ˆ ~61MB (+meta/text tens of MB)

WebP q=90: PNG ëŒ€ë¹„ 60~70% ì ˆê°

1 íŒŒì¸ (200ì¥) Ã— 90KB(í‰ê· ) â‰ˆ ~18MB/íŒŒì¸  â†’ 1,000 íŒŒì¸  â‰ˆ ~18GB(ì‹¤ì‚¬ìš©ì€ ë¼ë²¨/ë©”íƒ€ ì œì™¸í•œ ìˆœìˆ˜ í•™ìŠµì…‹ ê¸°ì¤€)

10.3 IO/íŒŒì´í”„ë¼ì¸ ìµœì í™”

Pinned memory + pre-decode tensor cache

Batch collation: í¬ë¡­ ì‚¬ì´ì¦ˆ ìƒí•œ/íŒ¨ë”© ê·œì¹™ í†µì¼

ONNX/TensorRT(CLIP/FGC)ë¡œ ì„ë² ë”© p95 â†“

1. ëª¨ë‹ˆí„°ë§ Â· ì•Œë¦¼ (ëŒ€ì‹œë³´ë“œ/ì§€í‘œ/ê·œì¹™)
11.1 í•µì‹¬ ì§€í‘œ
ì¹´í…Œê³ ë¦¬	ì§€í‘œ	ì„ê³„	ì¡°ì¹˜
SLO	ì†Œí˜• Recall, Top-1@BOM, ì˜¤ê²€ì¶œ, ë³´ë¥˜ìœ¨, FPS/p95	SLO ë¯¸ë‹¬	ëŸ°ë¶ 12ì¥ ì°¸ì¡°
Fusion	w_img/w_meta/w_txt ê°’Â·ë³€ê²½ ì´ë ¥	24h 3íšŒâ†‘	í…ìŠ¤íŠ¸/ë©”íƒ€ ì ê²€
FAISS	Stage-2 ì§„ì…ë¥ , confusions ì»¤ë²„ë¦¬ì§€, ê²€ìƒ‰ì‹œê°„	>25% / >15ms	í…œí”Œë¦¿ ë³´ê°•/Pruning
topo/area	ì ìš©ë¥ Â·ê°ì  ë¹ˆë„	ê¸‰ì¦	ë©”íƒ€ ê²€ì¦
WebP	decode p95	>15ms	LRU/ì›Œì»¤ í™•ì¥
Index	index_size	>120MB	Pruning íŠ¸ë¦¬ê±°
FGC	CLIP ëŒ€ë¹„ Î”Top-1	<0	1h ë‚´ ë¡¤ë°±

ëª¨ë“  ê²½ë³´ëŠ” operation_logsì™€ í†µí•©, Slack/Webhook ë°œì†¡(automation_config).

1. ëŸ°ë¶(ì¥ì•  ëŒ€ì‘)
ì¦ìƒ	ì¦‰ì‹œ ì¡°ì¹˜	í›„ì†
íƒì§€ ê³¼ì†Œ(Recallâ†“)	conf 0.15â†’0.12, imgsz 768â†’960, 11mâ†’v8-L	ë°ì´í„° QA ì¬ì ê²€(3ì¥)
ì‹ë³„ í˜¼ë™â†‘	Hard í…œí”Œë¦¿ +3/cls, w_meta/w_txt +0.05, margin 0.12	confusions ëª©ë¡ ë³´ê°•
ë³´ë¥˜ ê³¼ë‹¤	Stage-2 í™•ëŒ€, í…œí”Œë¦¿ ë‹¤ì–‘ì„± ë³´ê°•	RDA ê°•ë„ ì¡°ì •
FPS ì €í•˜	CLIP ONNX/TensorRT, WebP ìºì‹œ í™•ëŒ€, Stage-2 ì œí•œ	í•˜ë“œì›¨ì–´ ìŠ¤ì¼€ì¼
BOM ìŒìˆ˜	í ì •ì§€ + ìƒíƒœ ë¦¬ë¹Œë“œ	ë³‘í•© ë¡œì§/ë½ ê²€ì‚¬
Hungarian í 10â†‘	sync ëª¨ë“œ ì „í™˜	ì›Œì»¤ ìˆ˜/ë°°ì¹˜ í¬ê¸° ì¡°ì •
decode p95 >15ms	LRU ë°°ìˆ˜â†‘, ì›Œì»¤â†‘	q=92 ì¼ë¶€ êµ¬ê°„ ìƒí–¥ ê²€í† 
2. ë³´ì•ˆ Â· ë³€ê²½ê´€ë¦¬ Â· ë²„ì „ íƒœê¹…

ë°ì´í„°ì…‹/ëª¨ë¸/ì¸ë±ìŠ¤/ë©”íƒ€ ëª¨ë‘ ë²„ì „ í•´ì‹œ ê´€ë¦¬.

ì„¸íŠ¸ë³„ ë°°í¬ Manifest: detector/imgsz/fusion ê°€ì¤‘/ì¸ë±ìŠ¤ ë²„ì „/RDA ì •ì±….

ì ‘ê·¼ ì œì–´: ì¸ë±ìŠ¤Â·ë©”íƒ€ ì½ê¸° ìµœì†Œê¶Œí•œ, ë¡œê·¸ PII ë°°ì œ.

ë³€ê²½ ì´ë ¥: operation_logs(metadata: jsonb) í‘œì¤€í™”(ëˆ„ê°€ ë¬´ì—‡ì„ ì–¸ì œ ì™œ).

1. ê²€ì¦ Â· A/B Â· ì¸ìˆ˜ ê¸°ì¤€

ì‚¬ì „ ê²€ì¦: 3 ì„¸íŠ¸ Ã— 2,000 ìƒ˜í”Œ = 6,000ê±´ / ì„¸íŠ¸ë³„ SLO ì¤€ìˆ˜

A/B: Detector(11m vs v8-L), Top-K(Stage-1 5/10), Fusion(ë™ì /ê³ ì •), FGC Ensemble(3 ì„¤ì •)

ì¸ìˆ˜: SLO 5ì¼ ì—°ì† ì¶©ì¡±, ì£¼ìš” ì•Œë¦¼ ë¬´ë°œìƒ

ì„¸íŠ¸ ê·œëª¨ ë³´ì • A/B ê³„íš

small(100ë¶€í’ˆ): w_txt=0.10 vs 0.15
mid(1,000ë¶€í’ˆ): w_txt=0.15 ê³ ì •
large(3,000ë¶€í’ˆ): w_txt=0.15 vs 0.20
ê°€ì„¤: largeì—ì„œ w_txt=0.20 â†’ Top-1 +1~2%p

FGC Ensemble ìº˜ë¦¬ë¸Œë ˆì´ì…˜

slopeâˆˆ{1.0,1.2,1.5} Ã— pivotâˆˆ{0.15,0.20,0.25}

í‰ê°€: margin<0.1 ì¼€ì´ìŠ¤ Top-1, p95 latency, Stage-2 rate

1. ì˜ì‚¬ì½”ë“œ(í•µì‹¬ ëª¨ë“ˆ Â· í”„ë¡œë•ì…˜ ê°•í™”)
15.1 Two-Stage FAISS + Confusion-Aware Gate

# ì´ˆê¸°í™” 1íšŒ

confusion_index = {cls: set(meta[cls].confusions) for cls in classes}

cands = faiss_topk(query_emb, k=5, ef=128)  # Stage-1
top5 = set(cands.classes)

# í•´ë‹¹ ì¿¼ë¦¬ì˜ confusionsê°€ top5ì— ì—†ìœ¼ë©´ Stage-2

needs_stage2 = not confusion_index[query_class].isdisjoint(top5)
if needs_stage2:
cands = faiss_topk(query_emb, k=10, ef=160)  # Stage-2

sim_img  = cosine(img_emb,  tmpl_img[cands])
sim_meta = cosine(meta_emb, tmpl_meta[cands])
sim_txt  = cosine(txt_emb,  tmpl_txt[cands])

sim_final = w_img*sim_img + w_meta*sim_meta + w_txt*sim_txt \
- topo_penalty(query_mask, meta) + area_bonus(query_mask, cls_stats)

15.2 í—ê°€ë¦¬ì•ˆ(ê³„ì¸µÂ·í¬ì†ŒÂ·ë¹„ë™ê¸°, Option A)
from concurrent.futures import ThreadPoolExecutor, TimeoutError
pool = ThreadPoolExecutor(max_workers=4)

def process_frame(frame, bom_state):
dets = detect(frame)
crops = tight_crop(frame, dets)
embs  = embed(crops)

```
pairs = prefilter_topk(embs, k=3, thr=0.5)    # í¬ì†Œí™”
greedy = assign_greedy(high_conf(pairs, thr=0.9))  # ì¦‰ì‹œ

future = pool.submit(hungarian, mid_conf(pairs, 0.7, 0.9), bom_state.copy())
try:
    assign_mid = future.result(timeout=0.5)
except TimeoutError:
    assign_mid = greedy_fallback(pairs)
    log_alert("Hungarian timeout â†’ greedy used")

result = merge_assignments(greedy, assign_mid)
enqueue_for_single_writer(result)  # BOM ë³‘í•© (ë‹¨ì¼ ìŠ¤ë ˆë“œ)

```

15.3 WebP LRU í”„ë¦¬ìºì‹œ
class CachedWebPDataset:
def **init**(self, paths, cache_size=5000):
self.cache = LRU(cache_size)
self.pool  = ThreadPool(8)
def **getitem**(self, i):
if i in self.cache: return self.cache[i]
tensor = self.pool.apply(decode_webp, self.paths[i])
self.cache[i] = tensor
return tensor

15.4 FGC Adaptive Ensemble(ë§ˆì§„ ê¸°ë°˜)
margin = sim_top1 - sim_top2
w_fgc  = clamp(0.3 + (0.2 - margin)*1.2, 0.3, 0.7)  # A/Bë¡œ slope,pivot ìº˜ë¦¬ë¸Œë ˆì´íŠ¸
emb    = (1 - w_fgc) * clip_emb + w_fgc * fgc_emb

15.5 í…ìŠ¤íŠ¸ í’ˆì§ˆ ì´ˆê¸°í™”(ì–¸ì–´ ëŒ€ì‘)

# ì˜ˆì‹œ í‚¤ì›Œë“œ (ì´ˆê¸° 4ê°œ ì–¸ì–´)

KW = {
'en':['stud','hole','groove','print','color','brick'],
'ko':['ìŠ¤í„°ë“œ','êµ¬ë©','í™ˆ','í”„ë¦°íŠ¸','ìƒ‰ìƒ','ë¸Œë¦­'],
'ja':['ã‚¹ã‚¿ãƒƒãƒ‰','ç©´','æº','ãƒ—ãƒªãƒ³ãƒˆ','è‰²','ãƒ–ãƒ­ãƒƒã‚¯'],
'de':['Noppe','Loch','Nut','Aufdruck','Farbe','Stein']
}
def lang_aware_keyword_score(text, lang='en'):
L = detect_lang(text) or 'en'
keys = KW.get(L, KW['en'])
hits = sum(kw.lower() in text.lower() for kw in keys)
return min(hits/6, 0.4)  # max 0.4
def noun_density(text):
# spaCy / MeCab ë“±ìœ¼ë¡œ ëª…ì‚¬ë¹„ìœ¨ ì¸¡ì • (max 0.6*0.5=0.3)
return min(noun_ratio(text), 0.5) * 0.6

1. ë‹¨ìˆœí™”ëœ ì ì‘í˜• ìƒ˜í”Œë§ (v1.3 ì—…ë°ì´íŠ¸)
16.1 ì„¤ê³„ ì›ì¹™

ê¸°ì¡´ í‚¤ì›Œë“œ ê¸°ë°˜ ë³µì¡ë„ ë¶„ì„ì˜ í•œê³„ë¥¼ ê·¹ë³µí•˜ê³  ì•ˆì •ì„±ì„ ìš°ì„ ì‹œí•œ ë‹¨ìˆœí™”ëœ ì ‘ê·¼ë²•.

16.2 ìƒ˜í”Œë§ ì „ëµ

íˆ¬ëª…/ë°˜ì‚¬ ìƒ‰ìƒ ID (47-60): 960 ìƒ˜í”Œ (ê³ í’ˆì§ˆ ë Œë”ë§)
ê¸°ë³¸ ìƒ‰ìƒ: 512 ìƒ˜í”Œ (í‘œì¤€ ë Œë”ë§)

16.3 ì œê±°ëœ ê¸°ëŠ¥

í‚¤ì›Œë“œ ê¸°ë°˜ ë³µì¡ë„ ë¶„ì„: ë¶€í’ˆëª… ê¸°ë°˜ ë¶„ë¥˜ì˜ ë¶€ì •í™•ì„±
ë©”ëª¨ë¦¬ ìºì‹œ ì‹œìŠ¤í…œ: ë³µì¡ë„ ìºì‹œ, ì”¬ ìºì‹œ, ì¬ì§ˆ ìºì‹œ
ê³¼ë„í•œ ìºì‹±: ì„±ëŠ¥ í–¥ìƒ ë¯¸ë¯¸, ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¦ê°€

16.4 ì„±ëŠ¥ í–¥ìƒ

ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ 60% ê°ì†Œ
ë Œë”ë§ ì•ˆì •ì„± í–¥ìƒ
ì½”ë“œ ë³µì¡ë„ 40% ê°ì†Œ
ìœ ì§€ë³´ìˆ˜ì„± ëŒ€í­ ê°œì„ 

1. í•µì‹¬ íŒŒë¼ë¯¸í„° ìš”ì•½(ì´ˆê¸°ê°’Â·íŠœë‹ ë²”ìœ„)
êµ¬ë¶„	ê°’(ì´ˆê¸°)	íŠœë‹ ë²”ìœ„/ì¡°ê±´
YOLO(seg)	imgsz=768, conf=0.15, iou=0.60, max_det=1200	imgsz 960(ì†Œí˜• ë¦¬ì½œâ†‘), conf 0.12~0.18
ì¦ê°•	copy_paste=0.6, mosaic=0.5, fliplr=0.5, hsv(0.7,0.4,0.4), perspective=0.001, erasing=0.2	ì„¸íŠ¸ë³„ ë‚œì´ë„ ë”°ë¼ Â±0.1
ê²€ìƒ‰	FAISS HNSW M=32, ef=128(â†’160 Stage-2)	ef 96~192 (ì§€ì—°/ì •í™•ë„ íŠ¸ë ˆì´ë“œì˜¤í”„)
Fusion	w_img=0.65, w_meta=0.25, w_txt=0.15	ì„¸íŠ¸ ê·œëª¨/ì§€í‘œ ê¸°ë°˜ ìë™ ì¡°ì •
ì„ê³„	í™•ì • â‰¥ 0.80, ë³´ë¥˜ < 0.80 or margin < 0.10	ìš´ì˜ A/Bë¡œ 0.78~0.82 ê²€í† 
topo	ì ìš© ëŒ€ìƒë§Œ 0~0.08 ê°ì 	ì°¨ì´(Â±) í­ì— ë¹„ë¡€ ìŠ¤ì¼€ì¼
WebP	í•™ìŠµ q=90, í…œí”Œë¦¿ lossless(or q=95), SSIMthr=0.965	ì§€í‘œ ì•…í™” ì‹œ q=92 ì¬ì¸ì½”ë”©
ì ì‘í˜• ìƒ˜í”Œë§	íˆ¬ëª…ìƒ‰ìƒ 960, ê¸°ë³¸ 512 ìƒ˜í”Œ	íˆ¬ëª…ìƒ‰ìƒ ID ë²”ìœ„ ì¡°ì • ê°€ëŠ¥
2. ìš´ì˜ ì ˆì°¨(ë°°í¬Â·ë¡¤ë°±Â·ìŠ¹ê¸‰)

ì‚¬ì „ ë²¤ì¹˜(ëŒ€í‘œ 3ì„¸íŠ¸ Ã— 500í”„ë ˆì„) â†’ SLO ì²´í¬

Stage-1 ë°°í¬(10%): ê²½ë³´ ë¼ì¸ ì™„í™”(ì‹¤ì¸¡ í™•ë³´)

Stage-2(50%): Fusion auto-tune í—ˆìš©(24h ì œí•œ)

Full(100%): ê²½ë³´ ì„ê³„ SLOë¡œ ë³µê·€, ì¸ìˆ˜ ê¸°ì¤€ ì¶©ì¡± ì‹œ ìŠ¹ê¸‰

ë¡¤ë°± ê·œì¹™: FGC Î”Top-1<0, decode p95>15ms, BOM ìŒìˆ˜ ë°œìƒ ì‹œ ì¦‰ì‹œ ë¡¤ë°±

1. ì•Œë ¤ì§„ ì œì•½Â·í–¥í›„ ê³¼ì œ

í˜„ì¬ ì œì•½

ë¹„ë™ê¸° í—ê°€ë¦¬ì•ˆ: Option A(ìŠ¤ëƒ…ìƒ·+ë³‘í•©) ì±„íƒ â†’ ë³‘í•© ë¡œì§ íšŒê·€í…ŒìŠ¤íŠ¸ í•„ìš”

FGC Ensemble ìˆ˜ì‹: slope/pivot A/B ìº˜ë¦¬ë¸Œë ˆì´ì…˜ ëŒ€ê¸°

í…ìŠ¤íŠ¸ í’ˆì§ˆ ì–¸ì–´: ì´ˆê¸° 4ê°œ ì–¸ì–´(en/ko/ja/de)ë§Œ ê°€ì¤‘ ìµœì í™”

ë¡œë“œë§µ(12ê°œì›”)

Q1â€™26: FGC ìº˜ë¦¬ë¸Œë ˆì´ì…˜ ì™„ë£Œ â†’ Adaptive ê³ ì • ë˜ëŠ” 100% ì „í™˜

Q2â€™26: ë‹¤êµ­ì–´ 10ê°œ í™•ì¥, í‚¤ì›Œë“œ ì‚¬ì „ ê³ ë„í™”

Q3â€™26: Hard í…œí”Œë¦¿ Pruning 1ì°¨ ì‹¤í–‰, íš¨ê³¼ ê²€ì¦

Q4â€™26: ì„¸íŠ¸ 5,000 ë¶€í’ˆ í™•ì¥(ìŠ¤ì¼€ì¤„ëŸ¬/ë©”ëª¨ë¦¬ ìµœì í™”)

1. ê²°ë¡ (ìš´ì˜ ë³´ì¦)

ë³¸ ì„¤ê³„ëŠ” íƒì§€/ì‹ë³„ ë¶„ë¦¬ + FAISS Two-Stage + Adaptive Fusion + BOM ì œì•½ + QA/ì¤‘ë³µ ê´€ë¦¬ + WebP ìºì‹œë¥¼ ì¶•ìœ¼ë¡œ, **ì •í™•ë„(Recallâ‰¥0.95 Â· Top-1â‰¥0.97)**ì™€ **ì„±ëŠ¥(â‰¤150ms/frame)**ì„ ë™ì‹œ ë‹¬ì„±í•œë‹¤.
í•µì‹¬ ì„±ê³µ ìš”ì¸:

WebP ìš©ë„ë³„ ì••ì¶•(q=90 / í…œí”Œë¦¿ lossless) + SSIM ë³´ì •(0.965)

YOLO 1-class segë¡œ íƒì§€ ì „ë‹´, ì„ë² ë”©/ë©”íƒ€/í…ìŠ¤íŠ¸ë¡œ ì‹ë³„ ì „ë‹´

FAISS Two-Stageë¡œ ì§€ì—° í†µì œ + Recall í™•ë³´, confusion-aware ê²Œì´íŠ¸

Adaptive Fusion + topo/area ë³´ì •ìœ¼ë¡œ ì‹œê°Â·êµ¬ì¡°Â·ë¬¸ë§¥ì˜ ê· í˜•

- *í—ê°€ë¦¬ì•ˆ(ê³„ì¸µ/í¬ì†Œ/ë¹„ë™ê¸° + ì‹±ê¸€ ë¼ì´í„°)**ë¡œ ëŒ€ê·œëª¨ ì„¸íŠ¸ì—ì„œë„ ì¤‘ë³µ/ì´ˆê³¼ ì°¨ë‹¨

Hard í…œí”Œë¦¿ + ì •ê¸° rebuild + 3ë‹¨ê³„ Pruningìœ¼ë¡œ ì¸ë±ìŠ¤ ê±´ê°•ì„± ìœ ì§€

FGC-EncoderëŠ” ì •ëŸ‰ ê¸°ì¤€ ë° A/B ìº˜ë¦¬ë¸Œë ˆì´ì…˜ìœ¼ë¡œ ì ì§„Â·ì•ˆì „ ì „í™˜

ì´ ë¬¸ì„œì˜ íŒŒë¼ë¯¸í„°/ë¡œì§/ëŸ°ë¶ì„ ê·¸ëŒ€ë¡œ ì ìš©í•˜ë©´, WebP ì±„íƒ í•˜ì—ì„œë„ 12ê°œì›” ì´ìƒ ìš´ì˜ í’ˆì§ˆì˜ ì¼ê´€ì„±ì„ ìœ ì§€í•  ìˆ˜ ìˆë‹¤.

ë¶€ë¡ A. ìš´ì˜ ì²´í¬ë¦¬ìŠ¤íŠ¸(ë°°í¬ ì „/í›„)

ë°°í¬ ì „

YOLO ë²¤ì¹˜(768/960) + ì†Œí˜• ë¦¬ì½œ ì²´í¬

ì¸ë±ìŠ¤ í•´ì‹œ/ê²½ë¡œ ê²€ì¦(index_manifest)

WebP decode p95 ì¸¡ì •(ìºì‹œ on/off ë¹„êµ)

Fusion ì´ˆê¸°ê°’/ì„¸íŠ¸ ê·œëª¨ ë³´ì • ì„¸íŒ…

ê²½ë³´ ë¼ìš°íŒ…(Slack/Webhook) ìœ íš¨ì„±

ë°°í¬ í›„(24~72h)

Stage-2 ì§„ì…ë¥  â‰¤ 25% ìœ ì§€

w_txt ìë™ ì¡°ì • â‰¤ 3íšŒ/24h

BOM ìŒìˆ˜/í ì˜¤ë²„í”Œë¡œ 0ê±´

FGC Î”Top-1 â‰¥ 0 or ìë™ ë¡¤ë°± í™•ì¸

ë¶€ë¡ B. ê¶Œì¥ í•˜ë“œì›¨ì–´(ì¤‘ê¸‰ GPU ì˜ˆì‹œ)

GPU: RTX 4070/4080ê¸‰(12~16GB VRAM)

CPU: 8C/16T ì´ìƒ, NVMe SSD(>3GB/s)

RAM: 32~64GB, OS ìºì‹œ ì—¬ìœ 

ìŠ¤í† ë¦¬ì§€: ì„¸íŠ¸ 1,000 íŒŒì¸  ê¸°ì¤€ ~18GB(í•™ìŠµì…‹) + ì¸ë±ìŠ¤/ë©”íƒ€/ë¦¬í¬íŠ¸ ì—¬ìœ  50GB