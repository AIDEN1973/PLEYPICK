# Supabase Storage 동기화 최적화

## 현재 상태

### 업로드되는 파일
1. ✅ **WebP 이미지**: 필수 (학습 + 탐지 단계에서 사용)
2. ❌ **TXT 라벨**: 불필요 (로컬에만 있으면 됨)
3. ❌ **E1 JSON**: 불필요 (로컬에만 있으면 됨)
4. ❌ **E2 JSON**: 불필요 (로컬에만 있으면 됨)
5. ❌ **EXR 깊이 맵**: 불필요 (로컬에만 있으면 됨)

## 분석 결과

### 파일 사용 현황 (FILE_USAGE_BY_PIPELINE_STAGE.md 기준)

| 파일 | 학습 | 탐지 | 식별 | 품질 검증 | Storage 동기화 필요 |
|------|------|------|------|----------|-------------------|
| WebP | ✅ | ✅ | ❌ | ❌ | ✅ **필수** |
| TXT | ✅ | ❌ | ❌ | ❌ | ❌ 불필요 (로컬만) |
| E1 JSON | ❌ | ❌ | ❌ | ✅ | ❌ 불필요 (로컬만) |
| E2 JSON | ❌ | ❌ | ❌ | ✅ | ❌ 불필요 (로컬만) |
| EXR | ❌ | ❌ | ❌ | ✅ | ❌ 불필요 (로컬만) |

### 이유

1. **학습 단계**:
   - WebP 이미지: YOLO 학습 입력
   - TXT 라벨: YOLO 학습 Ground Truth
   - **학습은 로컬에서 실행되므로 로컬 파일 사용**

2. **탐지 단계**:
   - WebP 이미지: YOLO 추론 입력
   - **실시간 추론이므로 Storage에서 이미지 다운로드 필요**

3. **식별 단계**:
   - 모든 로컬 파일 불필요
   - **Supabase DB 테이블에서 직접 조회** (`parts_master_features`)

4. **품질 검증 단계**:
   - 모든 파일 로컬에서 사용
   - **오프라인 분석이므로 Storage 불필요**

## 최적화 방안

### WebP 이미지만 업로드
- ✅ 학습 단계에서 Supabase Storage에서 다운로드 가능
- ✅ 탐지 단계에서 Supabase Storage에서 다운로드 가능
- ✅ Storage 용량 절약 (TXT, JSON, EXR 제외)

### 로컬 파일 유지
- TXT, JSON, EXR 파일은 로컬에만 저장
- 품질 검증 및 오프라인 분석에 사용

## 예상 효과

### Storage 용량 절약
- TXT 라벨: 약 1-2 KB/파일 → 수백~수천 파일 절약
- E1 JSON: 약 10-50 KB/파일 → 수백~수천 파일 절약
- E2 JSON: 약 2-5 KB/파일 → 수백~수천 파일 절약
- EXR 깊이 맵: 약 1-5 MB/파일 → 수백~수천 파일 절약 (가장 큰 절약)

### 업로드 시간 단축
- 현재: 5개 파일 업로드 (이미지 + 라벨 + E1 + E2 + 깊이 맵)
- 최적화 후: 1개 파일 업로드 (이미지만)
- **업로드 시간 약 80% 단축**

### 네트워크 대역폭 절약
- EXR 파일이 가장 크므로 제외 시 큰 효과

## 권장 사항

1. **즉시 적용**: WebP 이미지만 Supabase Storage에 업로드
2. **로컬 저장 유지**: TXT, JSON, EXR 파일은 로컬에만 저장
3. **학습 스크립트 수정**: Supabase Storage에서 WebP 이미지만 다운로드하도록 수정 (필요 시)

