# 메타데이터 프롬프트 에디터 사용 가이드

**버전**: v1.0  
**페이지 경로**: `/metadata-prompt-editor`  
**작성일**: 2025-10-13

---

## 📋 개요

**메타데이터 프롬프트 에디터**는 LLM 기반 메타데이터 생성 시스템의 프롬프트와 설정을 프론트엔드에서 실시간으로 조정할 수 있는 관리 도구입니다.

### 주요 기능
- 📝 **프롬프트 편집**: LLM에 전달되는 프롬프트 템플릿 수정
- ⚙️ **LLM 설정**: 모델, temperature, max_tokens 등 조정
- ✅ **검증 규칙**: 필드 검증 조건 설정
- 🧪 **테스트**: 설정 즉시 테스트 및 미리보기
- 📦 **프리셋**: 자주 사용하는 설정 저장/불러오기

---

## 🚀 사용 방법

### 1. 페이지 접근

브라우저에서 다음 URL로 이동:
```
http://localhost:5173/metadata-prompt-editor
```

또는 애플리케이션 메뉴에서 **"메타데이터 설정"** 선택

---

### 2. 프롬프트 편집 탭

#### 📝 프롬프트 편집

**시스템 프롬프트**
- LLM의 역할을 정의합니다
- 기본값: "당신은 레고 부품 전문가입니다..."

**메인 프롬프트**
- JSON 형식과 필드를 정의합니다
- 변수 사용 가능:
  - `${partName}` - 부품명
  - `${partNum}` - 부품 번호
  - `${colorName}` - 색상명

**필수 요구사항**
- LLM이 따라야 할 규칙을 명시합니다

#### 미리보기
- 실시간으로 생성될 프롬프트를 확인할 수 있습니다
- 변수는 실제 값으로 치환되어 표시됩니다

---

### 3. LLM 설정 탭

#### ⚙️ 모델 선택
- **gpt-4o-mini** (권장): 빠르고 저렴, 대부분의 경우 충분
- **gpt-4o**: 고품질, 복잡한 부품에 적합
- **gpt-4-turbo**: 균형잡힌 선택

#### 파라미터 조정

**Temperature** (0.0 ~ 1.0)
- `0.0`: 결정론적, 일관된 출력 (권장)
- `0.3`: 약간의 변화
- `1.0`: 창의적, 다양한 출력

**Max Tokens** (100 ~ 2000)
- 응답 길이 제한
- 권장: 300-500 (Core-12 필드 기준)
- 높을수록 비용 증가

**Timeout** (3 ~ 30초)
- API 응답 대기 시간
- 권장: 8초

#### 고급 설정
- **Fallback 활성화**: 실패 시 gpt-4o로 재시도
- **JSON Mode**: JSON 형식 응답 강제 (권장)

#### 💰 예상 비용
- 설정에 따른 부품당 비용 실시간 계산
- 1000개 부품 기준 총 비용 표시

---

### 4. 검증 규칙 탭

#### ✅ 필드 검증

**recognition_hints.ko 필수**
- 최소 글자 수 설정 (기본: 20자)
- 자연스러운 한국어 설명 보장

**confusions 배열 필수**
- 유사 부품 최소 개수 설정
- FAISS 검색 정확도 향상

**distinguishing_features 필수**
- 구별되는 특징 최소 개수
- 부품 식별 정확도 향상

#### 자동화 설정

**프린트 부품 자동 감지**
- 부품번호에 'pr' 포함 시 is_printed = true
- 예: `110432pr0001` → `is_printed: true`

**recognition_hints 구조화**
- 문자열이 아닌 객체 형식으로 저장
- top_view, side_view, unique_features 포함

**부품번호 제거**
- feature_text에서 부품번호 자동 제거
- 자연스러운 텍스트 생성

#### 필수 필드 관리
- 필드명 입력 후 Enter로 추가
- × 버튼으로 제거
- 기본 필수 필드: part_id, shape_tag, stud_count_top 등

---

### 5. 테스트 탭

#### 🧪 프롬프트 테스트

**1. 테스트 부품 정보 입력**
```
부품번호: 3020
부품명: Plate 2 x 4
색상: Black
```

**2. 테스트 실행**
- "🧪 프롬프트 테스트 실행" 버튼 클릭
- 시뮬레이션 결과 즉시 확인

**3. 결과 확인**
- **소요 시간**: 프롬프트 생성 시간
- **토큰 사용**: 예상 토큰 수
- **비용**: 예상 API 비용
- **생성된 프롬프트**: 실제 LLM에 전달될 프롬프트
- **LLM 응답**: 시뮬레이션 응답
- **검증 결과**: 설정한 규칙 통과 여부

---

### 6. 프리셋 탭

#### 📦 기본 프리셋

**기본 설정 (v2.1)**
- 현재 권장 설정
- 한국어 프롬프트 + 구조화된 recognition_hints

**레거시 (v2.0)**
- 이전 버전 설정
- 영어 프롬프트 + 단순 문자열 recognition_hints

**06a13fe (초기 비전)**
- 초기 비전 테스트 버전
- temperature 0.3, maxTokens 1000

**고품질 (gpt-4o)**
- 가장 높은 품질
- 비용 2.5배, 속도 느림

**빠른 처리**
- 최소 설정
- maxTokens 200, timeout 5초

#### 사용자 프리셋

**저장**
1. 원하는 설정 적용
2. 프리셋 이름 입력
3. "💾 저장" 클릭

**불러오기**
- 저장된 프리셋 목록에서 "불러오기" 클릭

**삭제**
- "삭제" 버튼 클릭 (확인 필요)

---

### 7. 설정 저장 및 적용

#### 💾 설정 저장
- **로컬 스토리지**: 브라우저에 즉시 저장
- **Supabase** (선택): 서버에 백업 (테이블 없으면 스킵)

#### ✅ 설정 적용 및 배포
1. "✅ 설정 적용 및 배포" 클릭
2. 로컬 스토리지에 저장
3. **새로운 메타데이터 생성부터 즉시 반영**
4. 기존 데이터는 영향 없음

#### 📥 내보내기/가져오기
- **내보내기**: JSON 파일로 다운로드
- **가져오기**: JSON 파일 업로드

#### 🔄 초기화
- "🔄 기본값으로 초기화" 클릭
- v2.1 기본 설정으로 복원

---

## 🎯 사용 시나리오

### 시나리오 1: 프롬프트 개선

**목표**: feature_text 품질 향상

**단계**:
1. **프롬프트 편집** 탭 이동
2. 메인 프롬프트에 다음 추가:
   ```
   feature_text 생성 시 다음 규칙을 따르세요:
   - 부품번호 절대 포함 금지
   - 자연스러운 한국어 문장
   - 20자 이상 상세 설명
   ```
3. **테스트** 탭에서 확인
4. 만족스러우면 **설정 저장**
5. **설정 적용 및 배포**

### 시나리오 2: 비용 절감

**목표**: API 비용 50% 절감

**단계**:
1. **LLM 설정** 탭 이동
2. Max Tokens: 500 → **250**
3. Fallback: 활성화 → **비활성화**
4. Temperature: 0.0 유지
5. **예상 비용** 확인 (약 50% 감소)
6. **테스트**로 품질 확인
7. 품질이 괜찮으면 **적용**

### 시나리오 3: 프린트 부품 정확도 향상

**목표**: 프린트 부품 is_printed 자동 설정

**단계**:
1. **검증 규칙** 탭 이동
2. "프린트 부품 자동 감지" 체크
3. **프롬프트 편집**에 추가:
   ```
   distinguishing_features에 반드시 프린트 내용 포함
   예: ["penguin print", "black and white colors"]
   ```
4. **테스트** (부품번호: 110432pr0001)
5. is_printed: true 확인
6. **적용**

---

## 🔧 고급 사용

### 변수 활용

프롬프트에서 사용 가능한 변수:

```javascript
${partName}   // "Plate 2 x 4"
${partNum}    // "3020"
${colorName}  // "Black"
```

**예시**:
```
부품 ${partNum}(${partName})은 ${colorName} 색상입니다.
→ "부품 3020(Plate 2 x 4)은 Black 색상입니다."
```

### JSON 구조 커스터마이징

메인 프롬프트에서 JSON 구조 변경 가능:

```json
{
  "part_id": "${partNum}",
  "custom_field": "새로운 필드",
  "nested": {
    "field": "중첩 구조"
  }
}
```

⚠️ **주의**: 필수 필드는 유지해야 함

### 다국어 지원

recognition_hints에 다국어 추가:

```json
"recognition_hints": {
  "ko": "한국어 설명",
  "en": "English description",
  "ja": "日本語の説明"
}
```

---

## 📊 모니터링

### 설정 적용 확인

브라우저 콘솔에서 확인:
```javascript
// useMasterPartsPreprocessing.js 로드 시
✅ 사용자 설정 적용됨: {
  model: 'gpt-4o-mini',
  temperature: 0,
  maxTokens: 300
}

// 프롬프트 사용 시
✅ 사용자 정의 프롬프트 사용
```

### 로컬 스토리지 확인

개발자 도구 > Application > Local Storage:
- `metadata_prompt_config`: 현재 설정
- `custom_presets`: 사용자 프리셋 목록

---

## ⚠️ 주의사항

### 설정 변경 영향 범위
- **새로운 메타데이터만 영향**: 기존 데이터는 변경 없음
- **즉시 적용**: 저장 후 바로 다음 생성부터 반영
- **브라우저 로컬**: 다른 브라우저/디바이스에는 미적용

### 권장 사항
1. **백업**: 중요한 설정은 내보내기로 백업
2. **테스트**: 적용 전 반드시 테스트
3. **점진적 변경**: 한 번에 하나씩 수정
4. **모니터링**: 적용 후 품질 확인

### 복구 방법
설정이 잘못된 경우:
1. "🔄 기본값으로 초기화" 클릭
2. 또는 백업 파일 가져오기
3. 로컬 스토리지 수동 삭제:
   ```javascript
   localStorage.removeItem('metadata_prompt_config')
   ```

---

## 🐛 문제 해결

### 설정이 적용되지 않음
1. 브라우저 콘솔 확인
2. 로컬 스토리지 확인
3. 페이지 새로고침 (Ctrl+F5)
4. 캐시 삭제 후 재시작

### 테스트가 실패함
1. 프롬프트 형식 확인 (JSON 유효성)
2. 필수 필드 포함 확인
3. 변수 문법 확인 (`${partName}`)

### 비용이 너무 높음
1. Max Tokens 감소
2. Fallback 비활성화
3. 모델을 gpt-4o-mini로 변경

---

## 📚 참고 자료

### 관련 문서
- [메타데이터 시스템 개선 완료 보고서](./메타데이터_시스템_개선_완료_20251013.md)
- [메타데이터 개선 실행계획](./메타데이터_개선_실행계획.md)
- [메타데이터 분석 보고서](./메타데이터_분석_보고서_20251012.md)

### 코드
- 프론트엔드: `src/views/MetadataPromptEditor.vue`
- 백엔드 로직: `src/composables/useMasterPartsPreprocessing.js`
- 라우터 설정: `src/main.js`

### OpenAI 문서
- [GPT-4o-mini 가이드](https://platform.openai.com/docs/models/gpt-4o-mini)
- [Prompt Engineering](https://platform.openai.com/docs/guides/prompt-engineering)
- [JSON Mode](https://platform.openai.com/docs/guides/json-mode)

---

## 🎉 결론

메타데이터 프롬프트 에디터를 통해:
- ✅ 프롬프트를 실시간으로 조정
- ✅ 설정 변경의 영향 즉시 확인
- ✅ 비용과 품질의 균형 최적화
- ✅ 팀원 간 설정 공유 (내보내기/가져오기)

**처음 사용자**는 **기본 설정 (v2.1)**을 그대로 사용하시면 됩니다. 필요에 따라 점진적으로 최적화하세요!

---

**문의**: 문제 발생 시 개발팀에 문의  
**최종 업데이트**: 2025-10-13

