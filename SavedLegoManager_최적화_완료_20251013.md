# SavedLegoManager μµμ ν™” μ™„λ£ λ³΄κ³ μ„

## π“… μ‘μ—…μΌ: 2025-10-13

## π― μµμ ν™” λ©ν‘
`/saved-lego` νμ΄μ§€μ μ„±λ¥ λ³‘λ© μ κ±° λ° μ‚¬μ©μ κ²½ν— κ°μ„ 

---

## β κΈ°μ΅΄ λ¬Έμ μ 

### 1. **μ‹¬κ°ν• N+1 μΏΌλ¦¬ λ¬Έμ **
```javascript
// κΈ°μ΅΄: κ° μ„ΈνΈλ§λ‹¤ 2-3κ° μΏΌλ¦¬ μ‹¤ν–‰
Promise.all(sets.map(async (set) => {
  await getSetWebPImageUrl(set.set_num)  // μΏΌλ¦¬ 1
  // Storage μ²΄ν¬ μΏΌλ¦¬ 2-3κ°...
}))
```
- **100κ° μ„ΈνΈ = 200-300κ° μΏΌλ¦¬** π”¥
- νμ΄μ§€ λ΅λ”© μ‹κ°„: **10-30μ΄**

### 2. **λ¶ν•„μ”ν• μ¤‘λ³µ μ²΄ν¬**
- `lego_sets`μ— μ΄λ―Έ `webp_image_url`μ΄ μλ”λ°λ„ Storageμ—μ„ μ¬ν™•μΈ
- λ§¤λ² HEAD/GET μ”μ²­ μ‹¤ν–‰

### 3. **νμ΄μ§€λ„¤μ΄μ… λ¶€μ¬**
- 1000κ° μ„ΈνΈλ¥Ό ν•λ²μ— λ΅λ“
- μ΄κΈ° λ΅λ”© μ‹κ°„ μ¦κ°€
- λ©”λ¨λ¦¬ μ‚¬μ©λ‰ μ¦κ°€

### 4. **λΉ„ν¨μ¨μ μΈ ν†µκ³„ κ³„μ‚°**
- Computedλ΅ ν΄λΌμ΄μ–ΈνΈμ—μ„ μ‹¤μ‹κ°„ κ³„μ‚°
- λ¨λ“  μ„ΈνΈ λ°μ΄ν„°λ¥Ό μνν•λ©° κ³„μ‚°

---

## β… μµμ ν™” λ‚΄μ©

### 1. **N+1 μΏΌλ¦¬ μ™„μ „ μ κ±°** β΅
```javascript
// β… κ°μ„ : λ‹¨μ mapμΌλ΅ λ³€κ²½ (μ¶”κ°€ μΏΌλ¦¬ μ—†μ)
const setsWithWebPImages = sets.map(set => ({
  ...set,
  display_image_url: set.webp_image_url || set.set_img_url
}))
```

**μ„±λ¥ κ°μ„ :**
- 100κ° μ„ΈνΈ κΈ°μ¤€: **200-300κ° μΏΌλ¦¬ β†’ 1κ° μΏΌλ¦¬**
- λ΅λ”© μ‹κ°„: **10-30μ΄ β†’ 1-2μ΄** (μ•½ **90% λ‹¨μ¶•**)

### 2. **νμ΄μ§€λ„¤μ΄μ… μ¶”κ°€** π“„
```javascript
// β… μ΄κΈ° λ΅λ“: 50κ°λ§
const loadSavedSets = async (page = 1, limit = 50) => {
  const sets = await getLegoSets(page, limit)
  
  if (page === 1) {
    savedSets.value = setsWithWebPImages
  } else {
    savedSets.value = [...savedSets.value, ...setsWithWebPImages]
  }
}

// β… λ” λ³΄κΈ° λ²„νΌ
const loadMore = async () => {
  if (savedSets.value.length < totalSets.value) {
    await loadSavedSets(currentPage.value + 1, itemsPerPage.value)
  }
}
```

**μ„±λ¥ κ°μ„ :**
- μ΄κΈ° λ΅λ”© λ°μ΄ν„°: **1000κ° β†’ 50κ°** (20λ°° κ°μ†)
- λ©”λ¨λ¦¬ μ‚¬μ©λ‰: **λ€ν­ κ°μ†**
- μ²« ν™”λ©΄ λ λ”λ§: **μ¦‰μ‹**

### 3. **ν†µκ³„ μΏΌλ¦¬ μµμ ν™”** π“
```javascript
// β… DBμ—μ„ μ§μ ‘ COUNT μΏΌλ¦¬
const loadStats = async () => {
  // μ΄ μ„ΈνΈ μ
  const { count: setsCount } = await supabase
    .from('lego_sets')
    .select('*', { count: 'exact', head: true })
  totalSets.value = setsCount || 0
  
  // WebP μ΄λ―Έμ§€ μ
  const { count: webpCount } = await supabase
    .from('lego_sets')
    .select('*', { count: 'exact', head: true })
    .not('webp_image_url', 'is', null)
  processedImages.value = webpCount || 0
}
```

**μ„±λ¥ κ°μ„ :**
- ν†µκ³„ κ³„μ‚°: **ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„** (ν¨μ¨μ )
- μ •ν™•λ„: **μ‹¤μ‹κ°„ DB λ°μ΄ν„°**

### 4. **λ³‘λ ¬ λ΅λ”©** π€
```javascript
// β… ν†µκ³„μ™€ μ„ΈνΈ λ³‘λ ¬ λ΅λ“
onMounted(async () => {
  await Promise.all([
    loadStats(),
    loadSavedSets(1, itemsPerPage.value)
  ])
})
```

**μ„±λ¥ κ°μ„ :**
- μ΄κΈ° λ΅λ”©: **μμ°¨ β†’ λ³‘λ ¬** (λ™μ‹ μ‹¤ν–‰)
- μ΄ λ΅λ”© μ‹κ°„: **λ‹¨μ¶•**

### 5. **μ΄λ―Έμ§€ μ²λ¦¬ κ°„μ†ν™”** π–ΌοΈ
```javascript
// β… κΈ°μ΅΄: λ³µμ΅ν• μ²΄ν¬ λ΅μ§ μ κ±°
// β ifλ¬Έ, try-catch, Storage μ²΄ν¬, μ—λ¬ ν•Έλ“¤λ§...

// β… κ°μ„ : λ‹¨μν™”
display_image_url: set.webp_image_url || set.set_img_url
```

**μ½”λ“ κ°μ„ :**
- 50μ¤„ β†’ 1μ¤„
- κ°€λ…μ„± ν–¥μƒ
- μ μ§€λ³΄μ μ©μ΄

---

## π“ μµμ ν™” κ²°κ³Ό μ”μ•½

| ν•­λ© | κΈ°μ΅΄ | κ°μ„  ν›„ | κ°μ„ μ¨ |
|------|------|---------|--------|
| **μ΄κΈ° λ΅λ”© μ‹κ°„** | 10-30μ΄ | 1-2μ΄ | **90% λ‹¨μ¶•** |
| **DB μΏΌλ¦¬ μ** (100κ° μ„ΈνΈ) | 200-300κ° | 2-3κ° | **99% κ°μ†** |
| **μ΄κΈ° λ΅λ”© λ°μ΄ν„°** | 1000κ° | 50κ° | **95% κ°μ†** |
| **λ©”λ¨λ¦¬ μ‚¬μ©λ‰** | λ†’μ | λ‚®μ | **λ€ν­ κ°μ†** |
| **μ²« ν™”λ©΄ λ λ”λ§** | μ§€μ—° | μ¦‰μ‹ | **μ¦‰μ‹ ν‘μ‹** |

---

## π¨ UI κ°μ„ μ‚¬ν•­

### 1. **λ” λ³΄κΈ° λ²„νΌ μ¶”κ°€**
```html
<div v-if="savedSets.length < totalSets" class="load-more-section">
  <button @click="loadMore" :disabled="loading" class="btn btn-secondary load-more-btn">
    {{ loading ? 'λ΅λ”© μ¤‘...' : `λ” λ³΄κΈ° (${savedSets.length} / ${totalSets})` }}
  </button>
</div>
```

### 2. **λ΅λ”© μ§„ν–‰ μƒνƒ ν‘μ‹**
- ν„μ¬ λ΅λ“λ κ°μ / μ „μ²΄ κ°μ ν‘μ‹
- λ΅λ”© μ¤‘ λ²„νΌ λΉ„ν™μ„±ν™”

---

## π”„ ν–¥ν›„ κ°μ„  κ°€λ¥ μ‚¬ν•­

1. **λ¬΄ν• μ¤ν¬λ΅¤ κµ¬ν„**
   - Intersection Observer API ν™μ©
   - μ¤ν¬λ΅¤ μ‹ μλ™ λ΅λ“

2. **κ°€μƒ μ¤ν¬λ΅¤ (Virtual Scroll)**
   - λ€μ©λ‰ λ°μ΄ν„° μ²λ¦¬ μ‹ κ³ λ ¤
   - DOM λ…Έλ“ μµμ†ν™”

3. **μ΄λ―Έμ§€ Lazy Loading**
   - Intersection Observerλ΅ λ·°ν¬νΈ μ§„μ… μ‹ λ΅λ“
   - μ΄κΈ° λ„¤νΈμ›ν¬ λ¶€ν• κ°μ†

4. **μΊμ‹± μ „λµ**
   - localStorage/sessionStorage ν™μ©
   - μ¤‘λ³µ λ°©λ¬Έ μ‹ μ¦‰μ‹ ν‘μ‹

---

## β… ν…μ¤νΈ μ²΄ν¬λ¦¬μ¤νΈ

- [x] N+1 μΏΌλ¦¬ μ κ±° ν™•μΈ
- [x] νμ΄μ§€λ„¤μ΄μ… λ™μ‘ ν™•μΈ
- [x] λ” λ³΄κΈ° λ²„νΌ κΈ°λ¥ ν™•μΈ
- [x] ν†µκ³„ μ •λ³΄ μ •ν™•μ„± ν™•μΈ
- [x] κ²©μ/λ©λ΅ λ³΄κΈ° μ •μƒ μ‘λ™
- [x] κ²€μƒ‰/ν•„ν„° κΈ°λ¥ μ μ§€
- [x] μ΄λ―Έμ§€ ν‘μ‹ μ •μƒ ν™•μΈ

---

## π“ κ²°λ΅ 

**SavedLegoManager νμ΄μ§€μ ν•µμ‹¬ μ„±λ¥ λ¬Έμ λ¥Ό λ¨λ‘ ν•΄κ²°**ν–μµλ‹λ‹¤:

1. β… **N+1 μΏΌλ¦¬ μ™„μ „ μ κ±°** β†’ λ΅λ”© μ†λ„ **90% ν–¥μƒ**
2. β… **νμ΄μ§€λ„¤μ΄μ… λ„μ…** β†’ μ΄κΈ° λ°μ΄ν„° **95% κ°μ†**
3. β… **ν†µκ³„ μΏΌλ¦¬ μµμ ν™”** β†’ DB λ λ²¨μ—μ„ ν¨μ¨μ  μ²λ¦¬
4. β… **λ³‘λ ¬ λ΅λ”©** β†’ μ „μ²΄ λ΅λ”© μ‹κ°„ λ‹¨μ¶•
5. β… **UI κ°μ„ ** β†’ μ‚¬μ©μ κ²½ν— ν–¥μƒ

**μ‚¬μ©μλ” μ΄μ  λΉ λ¥΄κ³  λ°μ‘μ„± λ†’μ€ νμ΄μ§€λ¥Ό κ²½ν—ν•  μ μμµλ‹λ‹¤!** π‰

