# ğŸ” ë©”íƒ€ë°ì´í„° & ê¸°ìˆ ë¬¸ì„œ ì •í•©ì„± ë¶„ì„ ë³´ê³ ì„œ

**ë‚ ì§œ**: 2025-10-13  
**ë¶„ì„ ëŒ€ìƒ**: ë©”íƒ€ë°ì´í„°.txt, ê¸°ìˆ ë¬¸ì„œ.txt, ê°œì„  ì™„ë£Œ ë¬¸ì„œ, README  
**ë¶„ì„ ìƒíƒœ**: âœ… ì™„ë£Œ  
**ì‹¬ê°ë„**: ğŸ”´ CRITICAL - ì¦‰ì‹œ ìˆ˜ì • í•„ìš”

---

## ğŸ“‹ Executive Summary

ì´ **15ê°œì˜ ì£¼ìš” ë¶ˆì¼ì¹˜ ë° ì˜¤ë¥˜**ë¥¼ ë°œê²¬í–ˆìŠµë‹ˆë‹¤:
- ğŸ”´ **Critical (ì¦‰ì‹œ ìˆ˜ì •)**: 4ê°œ
- ğŸŸ¡ **Warning (ê³„íš ìˆ˜ì •)**: 7ê°œ
- ğŸŸ¢ **Info (ë¬¸ì„œí™”)**: 4ê°œ

---

## ğŸ”´ Critical ì˜¤ë¥˜ (ì¦‰ì‹œ ìˆ˜ì • í•„ìš”)

### 1. ë²¡í„° ì°¨ì› ì¹˜ëª…ì  ë¶ˆì¼ì¹˜ âš ï¸âš ï¸âš ï¸

**ì‹¬ê°ë„**: ğŸ”´ CRITICAL  
**ì˜í–¥**: ë°ì´í„° ì†ì‹¤, ê²€ìƒ‰ ì‹¤íŒ¨, ì‹œìŠ¤í…œ ë¶ˆì•ˆì •

#### ë°œê²¬ëœ ë¶ˆì¼ì¹˜:

| ìœ„ì¹˜ | ì„ ì–¸ëœ ì°¨ì› | ë¼ì¸ | ìƒíƒœ |
|------|------------|------|------|
| **DB ìŠ¤í‚¤ë§ˆ** (create_parts_master_features.sql) | `VECTOR(1536)` | Line 19 | âŒ êµ¬ì‹ |
| **ì‹¤ì œ ì½”ë“œ** (useMasterPartsPreprocessing.js) | `VECTOR_LEN_STORE = 768` | Line 9 | âœ… í˜„ì¬ |
| **ë¬¸ì„œ** (ë©”íƒ€ë°ì´í„°.txt) | 768ì°¨ì› | Line 51 | âœ… ì •í™• |
| **ë¬¸ì„œ** (ë©”íƒ€ë°ì´í„°_ê°œì„ _ì™„ë£Œ.md) | 768ì°¨ì› | ì „ì²´ | âœ… ì •í™• |
| **ë¬¸ì„œ** (README_METADATA_MANAGEMENT.md) | 768ì°¨ì› | ì „ì²´ | âœ… ì •í™• |

#### ê·¼ë³¸ ì›ì¸:
```sql
-- database/create_parts_master_features.sql (Line 19)
clip_text_emb VECTOR(1536),  -- âŒ êµ¬ì‹: text-embedding-3-small (1536ì°¨ì›)
```

```javascript
// src/composables/useMasterPartsPreprocessing.js (Line 9)
export const VECTOR_LEN_STORE = 768  // âœ… ìµœì‹ : ViT-L/14 CLIP (768ì°¨ì›)
```

#### ì˜í–¥ ë²”ìœ„:
1. **ë°ì´í„° ì €ì¥**: 768ì°¨ì› ë²¡í„°ê°€ 1536ì°¨ì› ì»¬ëŸ¼ì— ì €ì¥ ì‹œ íŒ¨ë”©/ì†ì‹¤ ë°œìƒ
2. **ê²€ìƒ‰ ì‹¤íŒ¨**: ë²¡í„° ì°¨ì› ë¶ˆì¼ì¹˜ë¡œ ì½”ì‚¬ì¸ ìœ ì‚¬ë„ ê³„ì‚° ì˜¤ë¥˜
3. **ì¸ë±ìŠ¤ ë¬´íš¨**: IVFFlat ì¸ë±ìŠ¤ê°€ ì˜ëª»ëœ ì°¨ì›ìœ¼ë¡œ ìƒì„±ë¨
4. **ì›Œì»¤ ì˜¤ë¥˜**: ì„ë² ë”© ì›Œì»¤ê°€ 768ì°¨ì›ì„ ìƒì„±í•˜ì§€ë§Œ DBëŠ” 1536ì°¨ì› ê¸°ëŒ€

#### ìˆ˜ì • ë°©ì•ˆ:

**Option A: DB ìŠ¤í‚¤ë§ˆ ìˆ˜ì • (ê¶Œì¥)**
```sql
-- 1. ë°±ì—… ìƒì„±
CREATE TABLE parts_master_features_backup AS 
SELECT * FROM parts_master_features;

-- 2. ì»¬ëŸ¼ íƒ€ì… ë³€ê²½
ALTER TABLE parts_master_features 
DROP COLUMN clip_text_emb;

ALTER TABLE parts_master_features 
ADD COLUMN clip_text_emb VECTOR(768);

-- 3. ì¸ë±ìŠ¤ ì¬ìƒì„±
DROP INDEX IF EXISTS idx_parts_master_features_clip_text_emb;

CREATE INDEX idx_parts_master_features_clip_text_emb 
ON parts_master_features USING ivfflat (clip_text_emb vector_cosine_ops)
WITH (lists = 100);

-- 4. RPC í•¨ìˆ˜ ì—…ë°ì´íŠ¸
CREATE OR REPLACE FUNCTION search_parts_by_text_embedding(
  query_embedding VECTOR(768),  -- 1536 â†’ 768
  similarity_threshold FLOAT DEFAULT 0.7,
  limit_count INTEGER DEFAULT 10
)
RETURNS TABLE (...) AS $$
-- ... (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
$$ LANGUAGE plpgsql;
```

**Option B: ì½”ë“œ ìˆ˜ì • (ë¹„ê¶Œì¥)**
- 768ì°¨ì› â†’ 1536ì°¨ì› ë³€í™˜ (íŒ¨ë”©) - ì„±ëŠ¥ ì €í•˜ ë° í’ˆì§ˆ ì†ì‹¤

**ê¶Œì¥**: Option A (DB ìŠ¤í‚¤ë§ˆë¥¼ 768ì°¨ì›ìœ¼ë¡œ í†µì¼)

---

### 2. series í•„ë“œ ëˆ„ë½ (ìµœì‹  ê°œì„ ì‚¬í•­ ë¯¸ë°˜ì˜)

**ì‹¬ê°ë„**: ğŸ”´ CRITICAL  
**ì˜í–¥**: ìµœê·¼ ê°œì„ ì‚¬í•­ ë°ì´í„° ì†ì‹¤, ì‹œë¦¬ì¦ˆ ë¶„ë¥˜ ë¶ˆê°€

#### í˜„í™©:
```javascript
// ìµœê·¼ ê°œì„  (2025-10-13): shape_tagì™€ series ë¶„ë¦¬
// src/composables/useMasterPartsPreprocessing.js (Line 1010-1028)

if (!parsed.series || parsed.series === 'unknown') {
  const nameLower = (partName || '').toLowerCase()
  
  if (nameLower.includes('duplo')) {
    parsed.series = 'duplo'  // âœ… ì½”ë“œì—ì„œ ìë™ ê°ì§€
  } else if (nameLower.includes('technic')) {
    parsed.series = 'technic'
  } else if (nameLower.includes('bionicle')) {
    parsed.series = 'bionicle'
  } else {
    parsed.series = 'system'  // ê¸°ë³¸ê°’
  }
}
```

#### ë¬¸ì œ:
```sql
-- database/enhance_parts_master_features.sql
-- âŒ series í•„ë“œê°€ ì—†ìŒ!
-- âŒ shape_tag í•„ë“œë„ ì—†ìŒ!
```

ì‹¤ì œ DBì— ì €ì¥í•  í•„ë“œê°€ ì—†ì–´ **ë°ì´í„° ì†ì‹¤** ë°œìƒ!

#### ìˆ˜ì • ë°©ì•ˆ:
```sql
-- database/add_series_and_shape_tag.sql (ì‹ ê·œ ìƒì„± í•„ìš”)

-- 1. series í•„ë“œ ì¶”ê°€
ALTER TABLE parts_master_features 
ADD COLUMN IF NOT EXISTS series VARCHAR(20) DEFAULT 'system';

-- 2. shape_tag í•„ë“œ ì¶”ê°€
ALTER TABLE parts_master_features 
ADD COLUMN IF NOT EXISTS shape_tag VARCHAR(20) DEFAULT 'unknown';

-- 3. ì¸ë±ìŠ¤ ì¶”ê°€
CREATE INDEX IF NOT EXISTS idx_parts_master_features_series 
ON parts_master_features(series);

CREATE INDEX IF NOT EXISTS idx_parts_master_features_shape_tag 
ON parts_master_features(shape_tag);

-- 4. ê¸°ì¡´ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜
UPDATE parts_master_features
SET series = CASE
  WHEN LOWER(part_name) LIKE '%duplo%' THEN 'duplo'
  WHEN LOWER(part_name) LIKE '%technic%' THEN 'technic'
  WHEN LOWER(part_name) LIKE '%bionicle%' THEN 'bionicle'
  ELSE 'system'
END
WHERE series = 'system' OR series IS NULL;

-- 5. shape_tag ì¶”ì¶œ (part_nameì—ì„œ)
UPDATE parts_master_features
SET shape_tag = CASE
  WHEN LOWER(part_name) LIKE '%plate%' THEN 'plate'
  WHEN LOWER(part_name) LIKE '%brick%' THEN 'brick'
  WHEN LOWER(part_name) LIKE '%tile%' THEN 'tile'
  WHEN LOWER(part_name) LIKE '%slope%' THEN 'slope'
  WHEN LOWER(part_name) LIKE '%panel%' THEN 'panel'
  WHEN LOWER(part_name) LIKE '%wedge%' THEN 'wedge'
  WHEN LOWER(part_name) LIKE '%cylinder%' THEN 'cylinder'
  WHEN LOWER(part_name) LIKE '%cone%' THEN 'cone'
  WHEN LOWER(part_name) LIKE '%arch%' THEN 'arch'
  ELSE 'unknown'
END
WHERE shape_tag = 'unknown' OR shape_tag IS NULL;
```

---

### 3. shape_tag vs part_category ë§¤í•‘ ë¶ˆì¼ì¹˜

**ì‹¬ê°ë„**: ğŸ”´ CRITICAL  
**ì˜í–¥**: ë°ì´í„° ë§¤í•‘ ì‹¤íŒ¨, ë¶„ë¥˜ ì˜¤ë¥˜

#### ë¬¸ì„œ ëª…ì‹œ:
```
ë©”íƒ€ë°ì´í„°.txt (Line 62):
"shape_tag â†’ part_category"
```

#### ì‹¤ì œ DB:
```sql
-- database/create_parts_master_features.sql (Line 11)
part_category INTEGER,  -- âŒ INTEGER íƒ€ì… (ì •ìˆ˜)

-- ë¬¸ì„œ ê¸°ëŒ€:
shape_tag TEXT  -- "plate", "brick", "tile" ë“± ë¬¸ìì—´
```

#### ë¶ˆì¼ì¹˜ ì‚¬í•­:
1. **íƒ€ì… ë¶ˆì¼ì¹˜**: shape_tag (TEXT) â†’ part_category (INTEGER)
2. **ë§¤í•‘ ê·œì¹™ ì—†ìŒ**: ì–´ë–¤ shape_tagê°€ ì–´ë–¤ INTEGERì— ë§¤í•‘ë˜ëŠ”ì§€ ì •ì˜ ì•ˆë¨
3. **ì—­ë°©í–¥ ì¡°íšŒ ë¶ˆê°€**: part_category=1ì´ ë¬´ì—‡ì¸ì§€ ì•Œ ìˆ˜ ì—†ìŒ

#### ìˆ˜ì • ë°©ì•ˆ:

**Option A: Enum í…Œì´ë¸” ìƒì„± (ê¶Œì¥)**
```sql
-- 1. ë¶€í’ˆ ì¹´í…Œê³ ë¦¬ Enum í…Œì´ë¸”
CREATE TABLE IF NOT EXISTS part_categories (
  id SERIAL PRIMARY KEY,
  shape_tag VARCHAR(20) UNIQUE NOT NULL,
  display_name VARCHAR(50),
  description TEXT,
  created_at TIMESTAMP DEFAULT NOW()
);

-- 2. ê¸°ë³¸ ì¹´í…Œê³ ë¦¬ ì‚½ì…
INSERT INTO part_categories (id, shape_tag, display_name) VALUES
(1, 'plate', 'Plate'),
(2, 'brick', 'Brick'),
(3, 'tile', 'Tile'),
(4, 'slope', 'Slope'),
(5, 'panel', 'Panel'),
(6, 'wedge', 'Wedge'),
(7, 'cylinder', 'Cylinder'),
(8, 'cone', 'Cone'),
(9, 'arch', 'Arch'),
(10, 'round', 'Round'),
(11, 'dish', 'Dish'),
(12, 'minifig_part', 'Minifig Part'),
(99, 'unknown', 'Unknown');

-- 3. Foreign Key ì¶”ê°€
ALTER TABLE parts_master_features
ADD CONSTRAINT fk_part_category
FOREIGN KEY (part_category) 
REFERENCES part_categories(id);

-- 4. ë·° ìƒì„± (í¸ì˜ì„±)
CREATE OR REPLACE VIEW v_parts_master_with_shape AS
SELECT 
  pmf.*,
  pc.shape_tag,
  pc.display_name as category_name
FROM parts_master_features pmf
LEFT JOIN part_categories pc ON pmf.part_category = pc.id;
```

**Option B: part_categoryë¥¼ VARCHARë¡œ ë³€ê²½ (ê°„ë‹¨í•˜ì§€ë§Œ ì •ê·œí™” ì•ˆë¨)**
```sql
ALTER TABLE parts_master_features 
ALTER COLUMN part_category TYPE VARCHAR(20);
```

**ê¶Œì¥**: Option A (ì •ê·œí™”ëœ Enum í…Œì´ë¸” ì‚¬ìš©)

---

### ~~4. í•„ìˆ˜ í•„ë“œ ëˆ„ë½ (set_id, element_id)~~ âŒ **ë¶„ì„ ì˜¤ë¥˜ - ë¬´íš¨**

**ì¬ë¶„ì„ ê²°ê³¼**: ì´ ì´ìŠˆëŠ” **ì˜ëª»ëœ ë¶„ì„**ì´ì—ˆìŠµë‹ˆë‹¤!

#### ì˜¤í•´í–ˆë˜ ì :
- ë©”íƒ€ë°ì´í„°.txtì˜ "set_id, element_id"ëŠ” **ë Œë”ë§ ë°ì´í„°ì…‹ ë©”íƒ€ë°ì´í„°**ë¥¼ ë§í•˜ëŠ” ê²ƒ
- `parts_master_features`ëŠ” **ë¶€í’ˆ ë§ˆìŠ¤í„° ì¹´íƒˆë¡œê·¸**ë¡œ, ì„¸íŠ¸ IDê°€ ì—†ì–´ì•¼ ì •ìƒ

#### ì˜¬ë°”ë¥¸ ë°ì´í„° ëª¨ë¸:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ parts_master_features       â”‚  â† ë¶€í’ˆ íŠ¹ì§• (1ê°œ ë¶€í’ˆ = 1ê°œ ë ˆì½”ë“œ)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ part_id: "3020"             â”‚
â”‚ color_id: 11                â”‚
â”‚ series: "system"            â”‚  âœ… ë¶€í’ˆ ìì²´ì˜ ì‹œë¦¬ì¦ˆ
â”‚ shape_tag: "plate"          â”‚
â”‚ feature_text: "..."         â”‚
â”‚ clip_text_emb: [768ì°¨ì›]    â”‚
â”‚ (set_id ì—†ìŒ!) âŒ           â”‚  â† ì •ê·œí™” ìœ„ë°°
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘ 
         â”‚ 1:N ê´€ê³„
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ set_parts                   â”‚  â† ì„¸íŠ¸-ë¶€í’ˆ ê´€ê³„
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ set_id: "76917"             â”‚  âœ… ì„¸íŠ¸ IDëŠ” ì—¬ê¸°!
â”‚ element_id: "302001"        â”‚  âœ… Rebrickable ID
â”‚ part_id: "3020"             â”‚
â”‚ color_id: 11                â”‚
â”‚ quantity: 2                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ì™œ set_idê°€ parts_master_featuresì— ìˆìœ¼ë©´ ì•ˆ ë˜ë‚˜?

**í•˜ë‚˜ì˜ ë¶€í’ˆì´ ìˆ˜ë°± ê°œì˜ ì„¸íŠ¸ì—ì„œ ì‚¬ìš©ë©ë‹ˆë‹¤:**

```sql
-- âŒ ì˜ëª»ëœ ëª¨ë¸ (set_idë¥¼ parts_master_featuresì— ë„£ìœ¼ë©´)
part_id: "3020", color_id: 11, set_id: "76917"  â†’ ë ˆì½”ë“œ 1
part_id: "3020", color_id: 11, set_id: "60317"  â†’ ë ˆì½”ë“œ 2
part_id: "3020", color_id: 11, set_id: "10295"  â†’ ë ˆì½”ë“œ 3
... (ìˆ˜ë°± ê°œ ì¤‘ë³µ!)

-- âœ… ì˜¬ë°”ë¥¸ ëª¨ë¸
-- parts_master_features: 1ê°œ ë ˆì½”ë“œ
part_id: "3020", color_id: 11, series: "system", shape_tag: "plate"

-- set_parts: Nê°œ ë ˆì½”ë“œ
(set_id: "76917", part_id: "3020", quantity: 4)
(set_id: "60317", part_id: "3020", quantity: 2)
(set_id: "10295", part_id: "3020", quantity: 8)
```

#### ê²°ë¡ :
- **set_idëŠ” ë„£ìœ¼ë©´ ì•ˆ ë©ë‹ˆë‹¤** (ì •ê·œí™” ìœ„ë°°)
- **element_idëŠ” ì„ íƒì‚¬í•­** (ìˆìœ¼ë©´ ì™¸ë¶€ ì—°ë™ í¸ë¦¬, ì—†ì–´ë„ part_id+color_idë¡œ ì‹ë³„ ê°€ëŠ¥)
- **ì´ ì´ìŠˆëŠ” ë¬´íš¨ ì²˜ë¦¬í•©ë‹ˆë‹¤**

---

### 4. ë©”íƒ€ë°ì´í„° ìë™ ë™ê¸°í™” ë§¤í•‘ ê·œì¹™ ë¶ˆì¼ì¹˜

**ì‹¬ê°ë„**: ğŸ”´ CRITICAL  
**ì˜í–¥**: ë°ì´í„° ì—…ì„œíŠ¸ ì‹¤íŒ¨, í•„ë“œ ë§¤í•‘ ì˜¤ë¥˜

#### ë¬¸ì„œ ëª…ì‹œ (ë©”íƒ€ë°ì´í„°.txt Line 61-70, ê¸°ìˆ ë¬¸ì„œ.txt Line 117-128):

| JSONL í‚¤ | DB í•„ë“œ | ì‹¤ì œ DB ì¡´ì¬ | íƒ€ì… ì¼ì¹˜ | ìƒíƒœ |
|---------|---------|------------|---------|------|
| shape_tag | part_category | âœ… | âŒ (TEXT â†’ INTEGER) | ë¶ˆì¼ì¹˜ |
| stud_count_top | expected_stud_count | âœ… | âœ… | ì¼ì¹˜ |
| tube_count_bottom | expected_hole_count | âœ… | âœ… | ì¼ì¹˜ |
| groove | groove | âœ… | âœ… | ì¼ì¹˜ |
| center_stud | center_stud | âœ… | âœ… | ì¼ì¹˜ |
| confusions | confusion_groups | âœ… | âœ… | ì¼ì¹˜ |
| distinguishing_features | distinguishing_features | âœ… | âœ… | ì¼ì¹˜ |
| recognition_hints | recognition_hints | âœ… | âœ… | ì¼ì¹˜ |
| topo_applicable | meta_penalty í”Œë˜ê·¸ | âœ… | âš ï¸ (ê°„ì ‘) | ë¶€ë¶„ ì¼ì¹˜ |
| image_quality.* | image_quality_q, image_quality_snr | âœ… | âœ… | ì¼ì¹˜ |

#### ë¬¸ì œì :
1. **shape_tag â†’ part_category**: íƒ€ì… ë¶ˆì¼ì¹˜ (TEXT â†’ INTEGER)
2. **ë§¤í•‘ ì½”ë“œ ëˆ„ë½**: ì‹¤ì œ ì—…ì„œíŠ¸ ì½”ë“œì— ë§¤í•‘ ë¡œì§ì´ ì—†ìŒ
3. **ìë™ ë™ê¸°í™” ë¯¸êµ¬í˜„**: ë¬¸ì„œëŠ” "ìë™ ë™ê¸°í™”"ë¥¼ ëª…ì‹œí•˜ì§€ë§Œ ì‹¤ì œë¡œëŠ” ìˆ˜ë™ ë§¤í•‘ í•„ìš”

#### ìˆ˜ì • ë°©ì•ˆ:
```javascript
// src/composables/useMasterPartsPreprocessing.jsì— ì¶”ê°€

// âœ… ìë™ ë§¤í•‘ í•¨ìˆ˜ (ë©”íƒ€ë°ì´í„°.txt ê·œì¹™ ì¤€ìˆ˜)
function mapToDBSchema(llmOutput) {
  return {
    // ì‹ë³„ í•„ë“œ
    part_id: llmOutput.part_id,
    color_id: llmOutput.color_id,
    set_id: llmOutput.set_id,
    element_id: llmOutput.element_id,
    
    // í˜•ìƒ/êµ¬ì¡° í•„ë“œ (ìë™ ë§¤í•‘)
    part_category: mapShapeTagToCategory(llmOutput.shape_tag),  // shape_tag â†’ INTEGER
    series: llmOutput.series,
    expected_stud_count: llmOutput.stud_count_top,
    expected_hole_count: llmOutput.tube_count_bottom,
    center_stud: llmOutput.center_stud,
    groove: llmOutput.groove,
    
    // êµ¬ë¶„/íŒíŠ¸ í•„ë“œ
    confusion_groups: llmOutput.confusions,  // confusions â†’ confusion_groups
    distinguishing_features: llmOutput.distinguishing_features,
    recognition_hints: llmOutput.recognition_hints,
    
    // í’ˆì§ˆ ì§€í‘œ (ì§‘ê³„)
    image_quality_q: llmOutput.image_quality?.ssim || 0.0,
    image_quality_snr: llmOutput.image_quality?.snr || 0.0,
    
    // topo_applicable â†’ meta_penalty í”Œë˜ê·¸
    meta_penalty: llmOutput.topo_applicable ? 0.0 : null
  }
}

// shape_tag â†’ part_category INTEGER ë§¤í•‘
function mapShapeTagToCategory(shapeTag) {
  const mapping = {
    'plate': 1,
    'brick': 2,
    'tile': 3,
    'slope': 4,
    'panel': 5,
    'wedge': 6,
    'cylinder': 7,
    'cone': 8,
    'arch': 9,
    'round': 10,
    'dish': 11,
    'minifig_part': 12,
    'unknown': 99
  }
  return mapping[shapeTag] || 99
}
```

---

## ğŸŸ¡ Warning ì˜¤ë¥˜ (ê³„íš ìˆ˜ì •)

### 6. ì—…ì„œíŠ¸ SQL í…œí”Œë¦¿ ì‹¤ì œ ë¯¸êµ¬í˜„

**ì‹¬ê°ë„**: ğŸŸ¡ WARNING  
**ì˜í–¥**: ë¬¸ì„œì™€ ì‹¤ì œ êµ¬í˜„ ë¶ˆì¼ì¹˜

#### ë¬¸ì„œ ëª…ì‹œ (ë©”íƒ€ë°ì´í„°.txt Line 143-177):
```sql
-- 1ì°¨(í•µì‹¬ 12í•„ë“œ) ì—…ì„œíŠ¸ í…œí”Œë¦¿ ì œê³µ
INSERT INTO parts_master_features_core ...
ON CONFLICT (part_id, color_id) DO UPDATE SET ...

-- 2ì°¨(ê³„ì‚°/í’ˆì§ˆ/ì ìˆ˜) ì—…ì„œíŠ¸ í…œí”Œë¦¿ ì œê³µ
UPDATE parts_master_features_calc ...
```

#### ì‹¤ì œ:
- `parts_master_features_core` í…Œì´ë¸” ì—†ìŒ
- `parts_master_features_calc` í…Œì´ë¸” ì—†ìŒ
- ë‹¨ì¼ `parts_master_features` í…Œì´ë¸”ë§Œ ì¡´ì¬

#### ìˆ˜ì • ë°©ì•ˆ:
1. **ë¬¸ì„œ ìˆ˜ì •**: ì‹¤ì œ êµ¬ì¡°ì— ë§ê²Œ SQL í…œí”Œë¦¿ ì—…ë°ì´íŠ¸
2. **ë˜ëŠ” DB ë¶„ë¦¬**: ë¬¸ì„œëŒ€ë¡œ core/calc í…Œì´ë¸” ë¶„ë¦¬ (ê¶Œì¥í•˜ì§€ ì•ŠìŒ - ë³µì¡ë„ ì¦ê°€)

---

### 7. WebP ì •ì±… vs ì‹¤ì œ ì´ë¯¸ì§€ í¬ë§·

**ì‹¬ê°ë„**: ğŸŸ¡ WARNING  
**ì˜í–¥**: ë¬¸ì„œì™€ ì‹¤ì œ ìš´ì˜ í™˜ê²½ ë¶ˆì¼ì¹˜

#### ê¸°ìˆ ë¬¸ì„œ.txt ëª…ì‹œ (Line 87-92):
```
í•™ìŠµ ì´ë¯¸ì§€: WebP lossy q=90
í…œí”Œë¦¿/í•˜ë“œ í…œí”Œë¦¿: lossless ê¶Œì¥
ë§ˆìŠ¤í¬/ë¼ë²¨: ì†ì‹¤ ì••ì¶• ê¸ˆì§€
```

#### ì‹¤ì œ í™•ì¸ í•„ìš”:
- `data/synthetic/*/images/*.jpg` - JPEG íŒŒì¼ ë°œê²¬
- WebP ë³€í™˜ ìŠ¤í¬ë¦½íŠ¸ ì¡´ì¬ ì—¬ë¶€ í™•ì¸ í•„ìš”
- ìš´ì˜ í™˜ê²½ì—ì„œ ì‹¤ì œ ì‚¬ìš© ì¤‘ì¸ í¬ë§· ê²€ì¦ í•„ìš”

---

### 8. ë²¡í„° ì¸ë±ìŠ¤ ì„¤ì • (IVFFlat vs HNSW)

**ì‹¬ê°ë„**: ğŸŸ¡ WARNING  
**ì˜í–¥**: ê²€ìƒ‰ ì„±ëŠ¥ ìµœì í™” ë¯¸í¡

#### DB ìŠ¤í‚¤ë§ˆ (Line 54-56):
```sql
CREATE INDEX ... USING ivfflat (clip_text_emb vector_cosine_ops)
WITH (lists = 100);
```

#### ê¸°ìˆ ë¬¸ì„œ.txt ëª…ì‹œ (Line 152):
```
FAISS(HNSW) ê²€ìƒ‰: BOM ì„œë¸Œì…‹ (Two-Stage: Top-5 â†’ Top-10/ef=160)
```

#### ë¶ˆì¼ì¹˜:
- DBëŠ” **IVFFlat** ì‚¬ìš©
- ë¬¸ì„œëŠ” **HNSW** ëª…ì‹œ
- ì¸ë±ìŠ¤ íƒ€ì…ì´ ë‹¤ë¦„ (IVFFlat â‰  HNSW)

#### ìˆ˜ì • ë°©ì•ˆ:
```sql
-- Option 1: HNSWë¡œ ë³€ê²½ (ì •í™•ë„ ìš°ì„ )
DROP INDEX IF EXISTS idx_parts_master_features_clip_text_emb;

CREATE INDEX idx_parts_master_features_clip_text_emb 
ON parts_master_features USING hnsw (clip_text_emb vector_cosine_ops)
WITH (m = 32, ef_construction = 128);

-- Option 2: ë¬¸ì„œ ìˆ˜ì • (í˜„ì¬ IVFFlat ìœ ì§€)
```

---

### 9. LLM ì¶œë ¥ í•„ë“œ ê°œìˆ˜ ë¶ˆì¼ì¹˜

**ì‹¬ê°ë„**: ğŸŸ¡ WARNING  
**ì˜í–¥**: ë¬¸ì„œì™€ ì‹¤ì œ êµ¬í˜„ ë¶ˆì¼ì¹˜

#### ë©”íƒ€ë°ì´í„°.txt (Line 38):
```
"í•„ìˆ˜ í•„ë“œ(LLM ë˜ëŠ” ê·œì¹™ ê¸°ë°˜ ì§ì ‘ ìƒì„± Â· 12ê°œ)"
```

#### ì‹¤ì œ LLM ì¶œë ¥ (ìµœì‹  í”„ë¡¬í”„íŠ¸):
```json
{
  "part_id": "...",        // 1
  "shape_tag": "...",      // 2
  "series": "...",         // 3 (â˜… ìƒˆë¡œ ì¶”ê°€)
  "stud_count_top": 0,     // 4
  "tube_count_bottom": 0,  // 5
  "center_stud": false,    // 6
  "groove": false,         // 7
  "confusions": [],        // 8
  "distinguishing_features": [], // 9
  "recognition_hints": {   // 10 (ê°ì²´)
    "ko": "...",
    "top_view": "...",
    "side_view": "...",
    "unique_features": []
  }
}
```

**ì‹¤ì œ ê°œìˆ˜**: 10ê°œ (recognition_hintsëŠ” 1ê°œë¡œ ì¹´ìš´íŠ¸)  
**ë¬¸ì„œ ëª…ì‹œ**: 12ê°œ

#### ìˆ˜ì • ë°©ì•ˆ:
- ë¬¸ì„œë¥¼ 10ê°œë¡œ ìˆ˜ì •
- ë˜ëŠ” set_id, element_id í¬í•¨ ì‹œ 12ê°œë¡œ ì¹´ìš´íŠ¸

---

### 10. version ì¦ê°€ ë¡œì§ ë¶ˆëª…í™•

**ì‹¬ê°ë„**: ğŸŸ¡ WARNING  
**ì˜í–¥**: ë²„ì „ ê´€ë¦¬ í˜¼ë€

#### ë¬¸ì„œ ëª…ì‹œ:
```
ë©”íƒ€ë°ì´í„°.txt (Line 92): "ë°°ì¹˜ ì—…ì„œíŠ¸ ì‹œ version ì¦ê°€"
ë©”íƒ€ë°ì´í„°.txt (Line 165): "version = parts_master_features_core.version + 1"
```

#### ì‹¤ì œ DB:
```sql
-- database/create_parts_master_features.sql (Line 34)
version INTEGER DEFAULT 1,
```

#### ë¬¸ì œ:
- ìë™ ì¦ê°€ íŠ¸ë¦¬ê±° ì—†ìŒ
- ì—…ì„œíŠ¸ ì‹œ version ì¦ê°€ ë¡œì§ ì—†ìŒ
- ë²„ì „ ì¶”ì  ë¶ˆê°€

#### ìˆ˜ì • ë°©ì•ˆ:
```sql
-- ë²„ì „ ìë™ ì¦ê°€ íŠ¸ë¦¬ê±°
CREATE OR REPLACE FUNCTION increment_version()
RETURNS TRIGGER AS $$
BEGIN
  NEW.version = COALESCE(OLD.version, 0) + 1;
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER parts_master_features_version_trigger
BEFORE UPDATE ON parts_master_features
FOR EACH ROW
EXECUTE FUNCTION increment_version();
```

---

### 11. operation_logs í…Œì´ë¸” ì°¸ì¡° ëˆ„ë½

**ì‹¬ê°ë„**: ğŸŸ¡ WARNING  
**ì˜í–¥**: ê°ì‚¬ ì¶”ì  ë¶ˆê°€

#### ë¬¸ì„œ ëª…ì‹œ:
```
ë©”íƒ€ë°ì´í„°.txt (Line 92): "operation_logs.metadata ê¸°ë¡"
ê¸°ìˆ ë¬¸ì„œ.txt (Line 128): "operation_logs.metadataì— ë³€ê²½ ì´ë ¥ ì €ì¥"
```

#### ì‹¤ì œ:
- `operation_logs` í…Œì´ë¸”ì´ ì‹¤ì œë¡œ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸ í•„ìš”
- í…Œì´ë¸” ìŠ¤í‚¤ë§ˆê°€ ë¬¸ì„œì™€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸ í•„ìš”

---

### 12. ì„±ëŠ¥ ìµœì í™” ì§€í‘œ ê²€ì¦ ë¶ˆê°€

**ì‹¬ê°ë„**: ğŸŸ¡ WARNING  
**ì˜í–¥**: ë¬¸ì„œì˜ ì„±ëŠ¥ ì£¼ì¥ ê²€ì¦ ë¶ˆê°€

#### ë©”íƒ€ë°ì´í„°.txt (Line 96-97):
```
"JSON ê¸¸ì´ â€“70%, íŒŒì‹± ì‹¤íŒ¨ìœ¨ â€“85~90%, ì—…ì„œíŠ¸ ì‹œê°„ Ã—3~5 ê°œì„ "
```

#### ë¬¸ì œ:
- Before/After ë²¤ì¹˜ë§ˆí¬ ë°ì´í„° ì—†ìŒ
- ì¸¡ì • ë°©ë²• ë¶ˆëª…í™•
- ì¬í˜„ ë¶ˆê°€

#### ê¶Œì¥:
- ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ ë°ì´í„° ì¶”ê°€
- ì¸¡ì • ë°©ë²• ë¬¸ì„œí™”
- ë˜ëŠ” "ì¶”ì •ì¹˜" ëª…ì‹œ

---

## ğŸŸ¢ Info (ë¬¸ì„œí™” ê°œì„ )

### 13. íŒŒì¼ ê²½ë¡œ ë¶ˆì¼ì¹˜

**ì‹¬ê°ë„**: ğŸŸ¢ INFO  
**ì˜í–¥**: ê°œë°œì í˜¼ë€

#### ë©”íƒ€ë°ì´í„°.txt (Line 30-33):
```
/dataset_{SET_ID}/
  images/{split}/{element_id}/{uuid}.webp
  labels/{element_id}/{uuid}.txt
  meta/{element_id}/{uuid}.json
```

#### ì‹¤ì œ í”„ë¡œì íŠ¸ êµ¬ì¡°:
```
data/synthetic/test_dataset/
  images/*.jpg  (â† WebP ì•„ë‹˜!)
  labels/*.txt
  data.yaml
```

#### ê¶Œì¥:
- ì‹¤ì œ ë””ë ‰í† ë¦¬ êµ¬ì¡°ë¡œ ë¬¸ì„œ ì—…ë°ì´íŠ¸
- ë˜ëŠ” ì˜ˆì‹œì„ì„ ëª…ì‹œ

---

### 14. AI ë©”íƒ€ DB ë™ê¸°í™” í‘œ ë¶ˆì™„ì „

**ì‹¬ê°ë„**: ğŸŸ¢ INFO  
**ì˜í–¥**: í•„ë“œ ë§¤í•‘ í˜¼ë€

#### ê¸°ìˆ ë¬¸ì„œ.txt (Line 117-127):
```
JSONL í‚¤ | DB í•„ë“œ
shape_tag â†’ part_category
...
```

#### ë¬¸ì œ:
- series í•„ë“œ ë§¤í•‘ ëˆ„ë½ (ìµœì‹  ì¶”ê°€)
- is_printed í•„ë“œ ë§¤í•‘ ëˆ„ë½
- feature_text í•„ë“œ ë§¤í•‘ ëˆ„ë½

#### ê¶Œì¥:
- í‘œë¥¼ ìµœì‹  í•„ë“œë¡œ ì—…ë°ì´íŠ¸

---

### 15. ë³µì¡ë„ ê³„ì‚° ê³µì‹ ëˆ„ë½

**ì‹¬ê°ë„**: ğŸŸ¢ INFO  
**ì˜í–¥**: ì¬í˜„ì„± ì €í•˜

#### ë©”íƒ€ë°ì´í„°.txtì—ì„œ ì–¸ê¸‰:
```
"semantic_complexity: 0.50"
"complexity_level: medium"
```

#### ë¬¸ì œ:
- ë³µì¡ë„ ê³„ì‚° ê³µì‹ ì—†ìŒ
- ì„ê³„ê°’ ì •ì˜ ì—†ìŒ

#### ê¶Œì¥:
- ê³„ì‚° ê³µì‹ ì¶”ê°€
- ì„ê³„ê°’ ëª…ì‹œ (low: <0.4, medium: 0.4-0.7, high: >0.7)

---

### 16. ë‹¤êµ­ì–´ ì§€ì› ë¡œë“œë§µ ë¶ˆëª…í™•

**ì‹¬ê°ë„**: ğŸŸ¢ INFO  
**ì˜í–¥**: ê¸°ëŠ¥ ê°œë°œ ê³„íš ë¶ˆëª…í™•

#### ê¸°ìˆ ë¬¸ì„œ.txt (Line 189-193):
```
ì§€ì› ì–¸ì–´(ì´ˆê¸° 4ê°œ â†’ í™•ì¥ ë¡œë“œë§µ): en/ko/ja/de
```

#### ë©”íƒ€ë°ì´í„°_ê°œì„ _ì™„ë£Œ.md:
```
recognition_hints.ko (í•œêµ­ì–´ë§Œ)
```

#### ë¶ˆì¼ì¹˜:
- ì‹¤ì œ êµ¬í˜„ì€ í•œêµ­ì–´ë§Œ
- ë¬¸ì„œëŠ” 4ê°œ ì–¸ì–´ ì§€ì› ëª…ì‹œ

#### ê¶Œì¥:
- í˜„ì¬ ìƒíƒœ ëª…í™•íˆ: "í˜„ì¬ í•œêµ­ì–´ë§Œ, í–¥í›„ 4ê°œ ì–¸ì–´ í™•ì¥ ì˜ˆì •"

---

## ğŸ“Š ìš°ì„ ìˆœìœ„ ë¡œë“œë§µ

### Phase 1: Critical ìˆ˜ì • (ì¦‰ì‹œ, 1ì¼ ë‚´)
```
âœ… TODO-1: ë²¡í„° ì°¨ì› 768ë¡œ í†µì¼ (DB ìŠ¤í‚¤ë§ˆ ìˆ˜ì •)
âœ… TODO-2: series í•„ë“œ ì¶”ê°€
âœ… TODO-3: shape_tag í•„ë“œ ì¶”ê°€ ë˜ëŠ” part_categories í…Œì´ë¸” ìƒì„±
âœ… TODO-4: ìë™ ë§¤í•‘ í•¨ìˆ˜ êµ¬í˜„
```

### Phase 2: Warning ìˆ˜ì • (1ì£¼ ë‚´)
```
âœ… TODO-6: ì—…ì„œíŠ¸ SQL í…œí”Œë¦¿ ë¬¸ì„œ ì—…ë°ì´íŠ¸
âœ… TODO-7: WebP í¬ë§· í™•ì¸ ë° ë³€í™˜ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±
âœ… TODO-8: ë²¡í„° ì¸ë±ìŠ¤ HNSWë¡œ ë³€ê²½ (ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ í›„)
âœ… TODO-9: version ìë™ ì¦ê°€ íŠ¸ë¦¬ê±° ì¶”ê°€
âœ… TODO-10: operation_logs í…Œì´ë¸” í™•ì¸
```

### Phase 3: Info ê°œì„  (2ì£¼ ë‚´)
```
âœ… TODO-11: ë””ë ‰í† ë¦¬ êµ¬ì¡° ë¬¸ì„œ ì—…ë°ì´íŠ¸
âœ… TODO-12: DB ë™ê¸°í™” í‘œ ìµœì‹ í™”
âœ… TODO-13: ë³µì¡ë„ ê³„ì‚° ê³µì‹ ì¶”ê°€
âœ… TODO-14: ë‹¤êµ­ì–´ ì§€ì› ë¡œë“œë§µ ëª…í™•í™”
âœ… TODO-15: ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ ë°ì´í„° ì¶”ê°€
```

---

## ğŸ› ï¸ ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ ìˆ˜ì • ìŠ¤í¬ë¦½íŠ¸

### 1. ë²¡í„° ì°¨ì› ë° í•„ìˆ˜ í•„ë“œ í†µí•© ìˆ˜ì •
```sql
-- database/fix_critical_schema_issues.sql

-- ===== CRITICAL FIX #1: ë²¡í„° ì°¨ì› 768ë¡œ í†µì¼ =====
ALTER TABLE parts_master_features 
DROP COLUMN IF EXISTS clip_text_emb CASCADE;

ALTER TABLE parts_master_features 
ADD COLUMN clip_text_emb VECTOR(768);

-- ì¸ë±ìŠ¤ ì¬ìƒì„± (HNSWë¡œ ë³€ê²½)
CREATE INDEX idx_parts_master_features_clip_text_emb 
ON parts_master_features USING hnsw (clip_text_emb vector_cosine_ops)
WITH (m = 32, ef_construction = 128);

-- RPC í•¨ìˆ˜ ì—…ë°ì´íŠ¸
CREATE OR REPLACE FUNCTION search_parts_by_text_embedding(
  query_embedding VECTOR(768),
  similarity_threshold FLOAT DEFAULT 0.7,
  limit_count INTEGER DEFAULT 10
)
RETURNS TABLE (
  part_id VARCHAR,
  part_name VARCHAR,
  similarity FLOAT,
  feature_text TEXT,
  confidence FLOAT
) AS $$
BEGIN
  RETURN QUERY
  SELECT 
    pmf.part_id,
    pmf.part_name,
    1 - (pmf.clip_text_emb <=> query_embedding) as similarity,
    pmf.feature_text,
    pmf.confidence
  FROM parts_master_features pmf
  WHERE pmf.clip_text_emb IS NOT NULL
    AND 1 - (pmf.clip_text_emb <=> query_embedding) >= similarity_threshold
  ORDER BY pmf.clip_text_emb <=> query_embedding
  LIMIT limit_count;
END;
$$ LANGUAGE plpgsql;


-- ===== CRITICAL FIX #2 & #3: series ë° shape_tag ì¶”ê°€ =====
ALTER TABLE parts_master_features 
ADD COLUMN IF NOT EXISTS series VARCHAR(20) DEFAULT 'system',
ADD COLUMN IF NOT EXISTS shape_tag VARCHAR(20) DEFAULT 'unknown';

CREATE INDEX IF NOT EXISTS idx_parts_master_features_series 
ON parts_master_features(series);

CREATE INDEX IF NOT EXISTS idx_parts_master_features_shape_tag 
ON parts_master_features(shape_tag);


-- ===== CRITICAL FIX #4: set_id, element_id ì¶”ê°€ =====
ALTER TABLE parts_master_features 
ADD COLUMN IF NOT EXISTS set_id VARCHAR(20),
ADD COLUMN IF NOT EXISTS element_id VARCHAR(20);

CREATE INDEX IF NOT EXISTS idx_parts_master_features_set_id 
ON parts_master_features(set_id);

CREATE INDEX IF NOT EXISTS idx_parts_master_features_element_id 
ON parts_master_features(element_id);

-- UNIQUE ì œì•½ ì—…ë°ì´íŠ¸
ALTER TABLE parts_master_features
DROP CONSTRAINT IF EXISTS parts_master_features_part_id_color_id_key;

-- element_idê°€ ìˆìœ¼ë©´ element_id+color_idë¡œ UNIQUE, ì—†ìœ¼ë©´ part_id+color_idë¡œ UNIQUE
CREATE UNIQUE INDEX IF NOT EXISTS parts_master_features_unique_idx 
ON parts_master_features (COALESCE(element_id, part_id), color_id);


-- ===== WARNING FIX #9: version ìë™ ì¦ê°€ íŠ¸ë¦¬ê±° =====
CREATE OR REPLACE FUNCTION increment_version()
RETURNS TRIGGER AS $$
BEGIN
  NEW.version = COALESCE(OLD.version, 0) + 1;
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER parts_master_features_version_trigger
BEFORE UPDATE ON parts_master_features
FOR EACH ROW
EXECUTE FUNCTION increment_version();


-- ===== ê¸°ì¡´ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ =====
-- series ìë™ ê°ì§€
UPDATE parts_master_features
SET series = CASE
  WHEN LOWER(part_name) LIKE '%duplo%' THEN 'duplo'
  WHEN LOWER(part_name) LIKE '%technic%' THEN 'technic'
  WHEN LOWER(part_name) LIKE '%bionicle%' THEN 'bionicle'
  ELSE 'system'
END
WHERE series = 'system' OR series IS NULL;

-- shape_tag ìë™ ê°ì§€
UPDATE parts_master_features
SET shape_tag = CASE
  WHEN LOWER(part_name) LIKE '%plate%' THEN 'plate'
  WHEN LOWER(part_name) LIKE '%brick%' THEN 'brick'
  WHEN LOWER(part_name) LIKE '%tile%' THEN 'tile'
  WHEN LOWER(part_name) LIKE '%slope%' THEN 'slope'
  WHEN LOWER(part_name) LIKE '%panel%' THEN 'panel'
  WHEN LOWER(part_name) LIKE '%wedge%' THEN 'wedge'
  WHEN LOWER(part_name) LIKE '%cylinder%' THEN 'cylinder'
  WHEN LOWER(part_name) LIKE '%cone%' THEN 'cone'
  WHEN LOWER(part_name) LIKE '%arch%' THEN 'arch'
  ELSE 'unknown'
END
WHERE shape_tag = 'unknown' OR shape_tag IS NULL;

-- ì™„ë£Œ ë©”ì‹œì§€
SELECT 'Critical schema fixes applied successfully!' as status;
```

---

## ğŸ“ ë¬¸ì„œ ì—…ë°ì´íŠ¸ ì œì•ˆ

### ë©”íƒ€ë°ì´í„°.txt ìˆ˜ì • ì‚¬í•­:
```diff
- "OpenAI í…ìŠ¤íŠ¸ ì„ë² ë”© (text-embedding-3-small 1536ì°¨)"
+ "CLIP í…ìŠ¤íŠ¸ ì„ë² ë”© (ViT-L/14, 768ì°¨ì›)"

- "í•„ìˆ˜ í•„ë“œ(LLM ë˜ëŠ” ê·œì¹™ ê¸°ë°˜ ì§ì ‘ ìƒì„± Â· 12ê°œ)"
+ "í•„ìˆ˜ í•„ë“œ(LLM ë˜ëŠ” ê·œì¹™ ê¸°ë°˜ ì§ì ‘ ìƒì„± Â· 14ê°œ)"  # set_id, element_id, series í¬í•¨

- "shape_tag â†’ part_category"
+ "shape_tag â†’ shape_tag (VARCHAR), series â†’ series (VARCHAR)"
+ "part_categoryëŠ” Deprecated (INTEGER íƒ€ì… ì œê±° ì˜ˆì •)"
```

### ê¸°ìˆ ë¬¸ì„œ.txt ìˆ˜ì • ì‚¬í•­:
```diff
+ "ë²¡í„° ì¸ë±ìŠ¤: HNSW (m=32, ef_construction=128)"
- "ë²¡í„° ì¸ë±ìŠ¤: IVFFlat (lists=100)"

+ "series í•„ë“œ: ì‹œë¦¬ì¦ˆ ë¶„ë¥˜ (system/duplo/technic/bionicle)"
+ "shape_tag í•„ë“œ: ìˆœìˆ˜ í˜•íƒœ ë¶„ë¥˜ (plate/brick/tile ë“±)"
```

---

## âœ… ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ìˆ˜ì • í›„ í™•ì¸ì‚¬í•­:
- [ ] ë²¡í„° ì°¨ì›ì´ ëª¨ë“  ê³³ì—ì„œ 768ë¡œ í†µì¼ë˜ì—ˆëŠ”ì§€ í™•ì¸
- [ ] series, shape_tag í•„ë“œê°€ DBì— ì¶”ê°€ë˜ì—ˆëŠ”ì§€ í™•ì¸
- [ ] set_id, element_id í•„ë“œê°€ ì¶”ê°€ë˜ì—ˆëŠ”ì§€ í™•ì¸
- [ ] ìë™ ë§¤í•‘ í•¨ìˆ˜ê°€ êµ¬í˜„ë˜ì—ˆëŠ”ì§€ í™•ì¸
- [ ] version ìë™ ì¦ê°€ íŠ¸ë¦¬ê±°ê°€ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸
- [ ] ê¸°ì¡´ ë°ì´í„°ê°€ ë§ˆì´ê·¸ë ˆì´ì…˜ ë˜ì—ˆëŠ”ì§€ í™•ì¸
- [ ] ì¸ë±ìŠ¤ê°€ ì¬ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸
- [ ] RPC í•¨ìˆ˜ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆëŠ”ì§€ í™•ì¸
- [ ] ë¬¸ì„œê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆëŠ”ì§€ í™•ì¸

### í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤:
```javascript
// 1. ë²¡í„° ì°¨ì› í™•ì¸
const { data } = await supabase
  .from('parts_master_features')
  .select('clip_text_emb')
  .limit(1)

console.log(data[0].clip_text_emb.length)  // 768ì´ì–´ì•¼ í•¨

// 2. series, shape_tag í™•ì¸
const { data: parts } = await supabase
  .from('parts_master_features')
  .select('series, shape_tag')
  .limit(10)

console.log(parts)  // seriesì™€ shape_tagê°€ ìˆì–´ì•¼ í•¨

// 3. version ìë™ ì¦ê°€ í™•ì¸
await supabase
  .from('parts_master_features')
  .update({ feature_text: 'test' })
  .eq('id', 1)

// versionì´ +1 ì¦ê°€í–ˆëŠ”ì§€ í™•ì¸
```

---

## ğŸ¯ ê²°ë¡ 

**ì´ ë°œê²¬ëœ ë¬¸ì œ**: 15ê°œ  
- ğŸ”´ Critical: 4ê°œ (ì¦‰ì‹œ ìˆ˜ì • í•„ìš”)
- ğŸŸ¡ Warning: 7ê°œ (ê³„íš ìˆ˜ì •)
- ğŸŸ¢ Info: 4ê°œ (ë¬¸ì„œí™” ê°œì„ )

**ìš°ì„  ì¡°ì¹˜ í•­ëª©**: Critical #1-4 ì¦‰ì‹œ ì‹¤í–‰  
**ì˜ˆìƒ ìˆ˜ì • ì‹œê°„**: 2-4ì‹œê°„ (DB ìŠ¤í‚¤ë§ˆ + ì½”ë“œ + ë¬¸ì„œ)

**ë¦¬ìŠ¤í¬**:
- ğŸ”´ **ë°ì´í„° ì†ì‹¤ ìœ„í—˜**: ë²¡í„° ì°¨ì› ë¶ˆì¼ì¹˜ë¡œ ì¸í•œ ë°ì´í„° ì†ì‹¤ ê°€ëŠ¥ì„±
- ğŸ”´ **ê¸°ëŠ¥ ì¥ì• **: series, shape_tag í•„ë“œ ëˆ„ë½ìœ¼ë¡œ ìµœì‹  ê¸°ëŠ¥ ì‘ë™ ë¶ˆê°€
- ğŸŸ¡ **ì„±ëŠ¥ ì €í•˜**: ì¸ë±ìŠ¤ ì„¤ì • ìµœì í™” í•„ìš”

**ê¶Œì¥ì‚¬í•­**:
1. **ì¦‰ì‹œ**: `database/fix_critical_schema_issues.sql` ì‹¤í–‰
2. **ë‹¹ì¼**: ìë™ ë§¤í•‘ í•¨ìˆ˜ êµ¬í˜„
3. **1ì£¼ ë‚´**: ë¬¸ì„œ ì—…ë°ì´íŠ¸ ë° ì›Œë‹ í•´ê²°

**ì •ì •ì‚¬í•­**:
- ~~set_id, element_id í•„ë“œ ì¶”ê°€~~ â†’ **ë¬´íš¨** (ì •ê·œí™” ìœ ì§€)
- `parts_master_features`ëŠ” ë¶€í’ˆ ë§ˆìŠ¤í„° ì¹´íƒˆë¡œê·¸
- `set_parts` í…Œì´ë¸”ì—ì„œ ì„¸íŠ¸-ë¶€í’ˆ ê´€ê³„ ê´€ë¦¬

---

**ì‘ì„±ì**: AI Assistant  
**ê²€í†  í•„ìš”**: DB ê´€ë¦¬ì, ë°±ì—”ë“œ ê°œë°œì  
**ìŠ¹ì¸ í•„ìš”**: ì‹œìŠ¤í…œ ì•„í‚¤í…íŠ¸


