# 신규 레고 등록 시 Semantic Vector 생성 가이드

## 개요

신규 레고 등록 시 Semantic Vector 생성을 잊지 않고 실행하기 위한 가이드입니다.

---

## 신규 등록 플로우

### 1단계: 신규 레고 등록

```
http://localhost:3000/new-lego
→ 세트 검색 및 저장
→ LLM 분석 + CLIP 임베딩 자동 생성
```

**완료 메시지 예시**:
```
🎉 세트 저장 완료!

🤖 자동 처리 시작:
• LLM 메타데이터 생성
• CLIP 임베딩 생성 (768차원)
• 데이터베이스 저장

⏱️ 예상 소요 시간: 40초
📋 작업 ID: llm-analysis-76917-1234567890

⚠️ 다음 단계 필수: Semantic Vector 생성
→ 메타데이터 관리 페이지 > Semantic Vector 탭에서 생성하세요.
→ 신규 등록 부품 필터를 사용하면 빠르게 찾을 수 있습니다.
```

---

### 2단계: Semantic Vector 생성

#### 방법 1: 신규 등록 부품 필터 사용 (권장)

1. **메타데이터 관리 페이지 이동**
   ```
   관리 메뉴 > 메타데이터 관리
   또는
   http://localhost:3000/metadata-management
   ```

2. **Semantic Vector 탭 선택**
   - 상단 탭에서 "🎯 Semantic Vector" 클릭

3. **신규 등록 부품 필터 활성화**
   ```
   ☑️ 신규 등록 부품만 보기 (최근 24시간 내 등록)
   ```

4. **일괄 생성 시작**
   - "일괄 생성 시작" 버튼 클릭
   - 신규 등록된 부품만 자동으로 필터링되어 생성됩니다

---

#### 방법 2: 수동 검색

1. **생성 기록 필터 사용**
   ```
   시작일: 오늘 날짜
   종료일: 오늘 날짜
   → 검색 버튼 클릭
   ```

2. **제로벡터 통계 확인**
   - 대시보드에서 "❌ 제로 벡터" 개수 확인
   - 제로벡터가 있으면 생성 필요

3. **일괄 생성 실행**
   - "일괄 생성 시작" 버튼 클릭

---

## 필터 옵션 설명

### 신규 등록 부품 필터

**기능**:
- 최근 24시간 내 `created_at`이 기록된 부품만 필터링
- 일괄 생성 시 신규 등록 부품만 자동으로 처리

**사용 시나리오**:
- 신규 레고 등록 후 바로 Semantic Vector 생성
- 최근 작업한 부품만 빠르게 처리

**활성화 방법**:
```
필터 옵션 > ☑️ 신규 등록 부품만 보기 (최근 24시간 내 등록)
```

---

## 품질 보증 체크리스트

생성 전 확인:
- [ ] Semantic Vector API 상태: 정상
- [ ] FGC Encoder 모델: 로드됨
- [ ] 이미지 URL 유효성 확인
- [ ] 배치 제한 설정 (기본: 200개)

생성 후 확인:
- [ ] 벡터 차원: 768D
- [ ] 벡터 norm: 0.95~1.05
- [ ] 제로벡터 없음
- [ ] 저장 후 검증 통과

---

## 문제 해결

### 신규 등록 부품이 필터에 안 보여요

**원인**:
- 24시간 이상 경과
- `created_at` 필드가 null 또는 잘못된 값

**해결**:
- 날짜 필터를 수동으로 설정 (예: 오늘 ~ 내일)
- 생성 기록 검색 사용

---

### 일괄 생성이 안 되요

**확인 사항**:
1. Semantic Vector API 상태 확인
2. FGC Encoder 모델 로드 확인
3. 이미지 URL 존재 확인
4. 배치 제한 확인

**해결**:
- 로그 메시지 확인
- 실패한 부품 목록 확인 후 재시도

---

## 자동화 개선 방안

### Option 1: 큐 시스템 추가

신규 등록 완료 시 Semantic Vector 생성 큐에 자동 추가:
```javascript
// useBackgroundLLMAnalysis.js에 추가
if (migrationComplete) {
  await queueSemanticVectors(analysisResults)
}
```

### Option 2: 알림 시스템

신규 등록 완료 시 Semantic Vector 생성 알림:
- 브라우저 알림
- Slack 알림
- 이메일 알림

### Option 3: 자동 이동 링크

완료 메시지에 클릭 가능한 링크 추가:
```html
<a href="/metadata-management?tab=semantic-vector&filter=new">
  Semantic Vector 생성 페이지로 이동
</a>
```

---

## 권장 워크플로우

### 일반적인 경우

```
1. 신규 레고 등록 (new-lego)
   ↓
2. LLM 분석 + CLIP 임베딩 자동 생성 (완료 메시지 확인)
   ↓
3. metadata-management로 이동
   ↓
4. Semantic Vector 탭 선택
   ↓
5. 신규 등록 부품 필터 활성화
   ↓
6. 일괄 생성 시작
   ↓
7. 생성 완료 후 통계 확인
```

### 대량 등록 시

```
1. 여러 세트 연속 등록
   ↓
2. 모든 세트 등록 완료 후
   ↓
3. metadata-management에서 날짜 필터로 범위 지정
   ↓
4. 일괄 생성 시작
```

---

## 참고

- 신규 등록 부품 필터는 `created_at` 기준입니다
- 24시간 경과 후에는 날짜 필터를 수동 설정해야 합니다
- 모든 품질 보증 검증이 통과되어야 저장됩니다

