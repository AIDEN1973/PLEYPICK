# 합성 데이터셋 정밀 점검 보고서

## 검증 대상
- 디렉토리: `output/synthetic/6179330`
- 검증 일시: 2025-11-02

---

## 1. 디렉토리 구조 검증

### 현재 구조
```
6179330/
├── images/         (200개 .webp)
├── labels/         (200개 .txt)
├── meta/           (200개 .json - Full Meta)
└── meta-e/         (200개 .json - Essential Meta)
```

### 검증 결과
- 디렉토리 구조: ✅ 정상
- 필수 폴더 모두 존재

---

## 2. 파일 매칭 검증

### 결과
- 전체 이미지: **200개**
- 완전 매칭: **200개** (100%)
- 라벨 누락: **0개**
- Full 메타 누락: **0개**
- Essential 메타 누락: **0개**

### 분석
모든 이미지에 대해 라벨, Full 메타, Essential 메타가 정확히 매칭됩니다.

---

## 3. JSON 스키마 검증

### E1 (Full Meta) 검증 결과
- 검증 샘플: 20개
- 유효: 0개
- 무효: 20개

**주요 이슈:**
1. AI 메타 필드 누락 (LLM 생성 필요)
   - `set_id`: 누락
   - `shape_tag`: 누락
   - `series`: 누락
   - `stud_count_top`: 누락
   - `tube_count_bottom`: 누락

**원인:**
- 현재 E1 메타는 렌더링 메타만 포함 (렌더링 파이프라인 산출물)
- AI 메타는 LLM 분석 후 추가 생성됨
- 렌더링 파이프라인에서는 LLM 분석이 자동 실행되지 않음
- 신규 레고 등록 시에만 LLM 분석이 자동 실행됨 (NewLegoRegistration.vue)
- 합성 데이터셋은 별도로 LLM 분석을 실행해야 함

### E2 (Essential Meta) 검증 결과
- 검증 샘플: 20개
- 유효: **20개** (100%)
- 무효: 0개

**검증 통과 항목:**
- `schema_version`: "1.6.1-E2" ✅
- `part_id`: 존재 ✅
- `annotation`: 존재 ✅
  - `bbox_pixel_xyxy`: 존재 ✅
  - `bbox_norm_xyxy`: 존재 ✅
- `qa`: 존재 ✅
  - `qa_flag`: 존재 ✅

---

## 4. 라벨 파일 검증

### 결과
- 검증 샘플: 10개
- 유효: **10개** (100%)
- 무효: 0개

### 형식 확인
- YOLO Segmentation 형식 준수
- 좌표 정규화 범위 확인 (0.0 ~ 1.0)
- bbox + polygon 좌표 포함

### 샘플 라벨
```
0 0.506908 0.572269 0.708640 0.511803 0.171050 0.729584 ...
```
- 형식: `class x_center y_center width height x1 y1 x2 y2 ...`
- 정상

---

## 5. 이미지 품질 검증

### 결과
- 검증 샘플: 10개
- 유효: **10개** (100%)
- 무효: 0개

### 품질 지표 통계 (샘플 50개)
- **SSIM**: 평균 1.0000, 최소 1.0000 (기준: ≥0.965) ✅
- **SNR**: 평균 46.67 dB, 최소 43.96 dB (기준: ≥30 dB) ✅
- **재투영 RMS**: 평균 2.91 px, 최대 3.54 px (기준: ≤1.5px) ❌
- **깊이 점수**: 평균 0.0042, 최대 0.0071 (기준: ≥0.85) ❌

**품질 이슈:**
1. 재투영 RMS: **100% 미달** (50/50 샘플 모두 초과)
   - 평균 2.91px > 1.5px (기준의 약 2배)
   - 최대 3.54px (기준의 약 2.4배)

2. 깊이 점수: **100% 미달** (50/50 샘플 모두 미달)
   - 평균 0.0042 < 0.85 (기준의 약 0.5%)
   - 최대 0.0071 (기준의 약 0.8%)

**영향:**
- 재투영 오차가 큼 → PnP Solver 정확도 문제, 3D 정합 실패 가능
- 깊이 정보 품질 극도로 낮음 → 깊이 기반 처리 불가
- 이는 **심각한 품질 문제**로, 렌더링 파이프라인 개선 필요

---

## 6. 전체 요약

### 통과 항목
- ✅ 디렉토리 구조
- ✅ 파일 매칭 (100%)
- ✅ E2 (Essential Meta) 스키마 (100%)
- ✅ 라벨 파일 형식 (100%)
- ✅ 이미지 기본 품질 (100%)

### 개선 필요 항목

#### 1. E1 (Full Meta) - AI 메타 누락
**상태:** 정상 (LLM 분석 대기)
**조치:** LLM 분석 실행하여 AI 메타 생성

#### 2. 품질 메트릭 미달
**문제:**
- 재투영 RMS: 2.98px (기준: ≤1.5px)
- 깊이 점수: 0.005 (기준: ≥0.85)

**원인 추정:**
- PnP Solver 파라미터 조정 필요
- 깊이 맵 생성 품질 개선 필요

**권장 조치:**
1. PnP Solver 재투영 오차 개선
2. 깊이 맵 생성 품질 향상
3. 품질 기준 미달 샘플 재렌더링

---

## 7. 기술문서 준수 현황

### 준수 항목
- ✅ 디렉토리 레이아웃 (images/labels/meta/meta-e)
- ✅ WebP 이미지 형식
- ✅ YOLO 라벨 형식
- ✅ E2 스키마 (v1.6.1-E2)
- ✅ SSIM 기준 (≥0.965)
- ✅ SNR 기준 (≥30 dB)

### 미준수 항목
- ❌ **재투영 RMS 기준 (≤1.5px) → 평균 2.91px** (100% 미달)
- ❌ **깊이 점수 기준 (≥0.85) → 평균 0.0042** (100% 미달)
- ⚠️ AI 메타 필드 누락 (LLM 생성 전 상태 - 정상)

---

## 8. 권장 조치 사항

### 즉시 조치 (필수)
1. **품질 메트릭 개선 (최우선)**
   - 재투영 RMS 개선 (PnP Solver 파라미터 조정)
     - 현재: 평균 2.91px (기준의 2배)
     - 목표: ≤1.5px
     - 원인 추정: 카메라 캘리브레이션, PnP 해법 정확도
   - 깊이 점수 개선 (깊이 맵 생성 개선)
     - 현재: 평균 0.0042 (기준의 0.5%)
     - 목표: ≥0.85
     - 원인 추정: 깊이 렌더링 설정, Z-buffer 정확도

2. **LLM 분석 실행 (합성 데이터셋용)**
   - 합성 데이터셋은 렌더링 파이프라인에서 생성되므로 LLM 분석이 자동 실행되지 않음
   - 메타데이터 관리 페이지에서 수동 실행 필요
   - 또는 배치 스크립트로 일괄 처리
   - AI 메타 생성 (shape_tag, series, stud_count_top, tube_count_bottom 등)
   - E1 메타 완성

### 중기 조치 (권장)
1. **품질 기준 미달 샘플 재렌더링**
   - 재투영 RMS > 1.5px 샘플
   - 깊이 점수 < 0.85 샘플

2. **품질 검증 자동화**
   - 렌더링 후 자동 품질 검증
   - 기준 미달 샘플 자동 재렌더링

---

## 결론

**전체 평가: 구조 정상, 품질 메트릭 심각**

- 파일 구조: ✅ 완벽
- 파일 매칭: ✅ 완벽 (200/200)
- E2 메타: ✅ 완벽 (20/20 유효)
- 라벨 형식: ✅ 완벽 (10/10 유효)
- 이미지 기본 품질: ✅ 완벽
- E1 메타: ⚠️ AI 메타 대기 중 (LLM 분석 필요 - 정상)
- 품질 메트릭: ❌ **심각** (재투영 RMS 100% 미달, 깊이 점수 100% 미달)

**핵심 이슈 (우선순위):**
1. **재투영 RMS 개선** (필수)
   - 현재: 평균 2.91px, 기준: ≤1.5px
   - 100% 샘플 기준 미달
   - PnP Solver 파라미터 조정 필요

2. **깊이 점수 개선** (필수)
   - 현재: 평균 0.0042, 기준: ≥0.85
   - 100% 샘플 기준 미달
   - 깊이 렌더링 설정 개선 필요

3. AI 메타 생성 (권장)
   - LLM 분석 실행하여 shape_tag, series 등 생성

**권장 조치:**
- 렌더링 파이프라인에서 PnP Solver와 깊이 맵 생성 로직 재검토
- 품질 기준 미달 샘플 재렌더링 또는 렌더링 설정 조정

