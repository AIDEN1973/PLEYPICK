# 렌더링 실패 분석 보고서

## 문제 요약

세트 76917 (106개 부품) 렌더링 요청 후:
- **폴더 구조 생성**: 34개 폴더 생성됨
- **실제 렌더링 완료**: 1개 부품만 완료 (6179330: 200개 파일)
- **실패**: 33개 부품 (97.1%) - 폴더만 생성되고 파일 없음

## 분석 결과

### 1. 폴더 구조는 정상 생성됨
```
output/synthetic/
  ├── 302126/ (빈 폴더 - images, labels, meta 폴더만)
  ├── 302426/ (빈 폴더)
  ├── 6179330/ (완료 - 200개 webp, 200개 txt, json 파일)
  ├── ...
```

### 2. 병렬 처리 문제

**현재 코드 (server/synthetic-api.js:1344-1345)**:
```javascript
// 모든 렌더링 작업 대기 (병렬 처리)
await Promise.allSettled(renderPromises)
```

**문제점**:
1. 106개 Blender 프로세스를 동시에 시작 시도
2. 시스템 리소스 부족 (메모리, 프로세스 제한)
3. Blender 프로세스가 시작되지 않거나 즉시 실패
4. 폴더는 생성되지만 파일 저장 전 프로세스 종료

### 3. Blender 프로세스 시작 실패 가능성

**코드 위치 (server/synthetic-api.js:1521-1537)**:
```javascript
blenderProcess = spawn(blenderPath, args, {
  cwd: path.join(__dirname, '..'),
  env: { ...process.env, PYTHONIOENCODING: 'utf-8' }
})
```

**실패 원인**:
- 동시 프로세스 제한 초과
- Blender 경로 문제
- 메모리 부족으로 즉시 크래시
- 프로세스 시작 실패 시 에러가 무시됨 (`Promise.allSettled`가 실패를 무시)

## 해결 방안

### 즉시 해결

1. **순차 처리로 변경** (106개 동시 실행 불가)
   - 배치 크기 제한 (예: 5-10개씩 처리)
   - 큐 시스템 도입

2. **에러 로깅 강화**
   - Blender 프로세스 시작 실패 시 로그 기록
   - 각 부품별 실패 이유 저장

3. **재시도 메커니즘**
   - 실패한 부품만 재렌더링
   - 실패 추적 시스템

### 근본 해결

1. **배치 처리 시스템**
   - 작업 큐 사용 (예: Bull, BullMQ)
   - 동시 실행 제한 (concurrency limit)
   - 실패 재시도 자동화

2. **리소스 관리**
   - 메모리 모니터링
   - 프로세스 수 제한
   - 우선순위 큐

3. **상태 추적**
   - 각 부품별 렌더링 상태 DB 저장
   - 진행률 실시간 추적
   - 실패 원인 기록

## 권장 조치

1. **즉시**: 빈 폴더 삭제 후 재렌더링
2. **단기**: 배치 크기 제한 (5-10개씩)
3. **장기**: 큐 시스템 도입












