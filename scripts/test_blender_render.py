#!/usr/bin/env python3 """ BrickBox Blender 테스트 렌더링 스크립트 Blender 내부에서 실행되는 간단한 테스트 스크립트 - LDraw 파일 로드 테스트 - 기본 렌더링 테스트 - 로컬 파일 저장 """ import bpy import bmesh import os import sys import math import mathutils from mathutils import Vector, Euler import random def clear_scene(): """씬 초기화""" bpy.ops.object.select_all(action='SELECT') bpy.ops.object.delete(use_global=False) def setup_camera(): """카메라 설정""" bpy.ops.object.camera_add(location=(0, -5, 2)) camera = bpy.context.object camera.name = "TestCamera" camera.rotation_euler = (math.radians(60), 0, 0) bpy.context.scene.camera = camera def setup_lighting(): """조명 설정""" # 키 라이트 bpy.ops.object.light_add(type='SUN', location=(2, -2, 5)) key_light = bpy.context.object key_light.name = "KeyLight" key_light.data.energy = 3.0 # 필 라이트 bpy.ops.object.light_add(type='AREA', location=(-2, -1, 3)) fill_light = bpy.context.object fill_light.name = "FillLight" fill_light.data.energy = 1.5 def setup_render_settings(): """렌더링 설정""" bpy.context.scene.render.engine = 'CYCLES' bpy.context.scene.render.resolution_x = 640 bpy.context.scene.render.resolution_y = 640 bpy.context.scene.cycles.samples = 32 bpy.context.scene.render.image_settings.file_format = 'WEBP' bpy.context.scene.render.image_settings.quality = 80 # WebP Q80 품질 설정 bpy.context.scene.render.image_settings.color_mode = 'RGB' def load_ldraw_part(part_path): """LDraw 부품 로드""" try: # LDraw Importer Add-on 자동 활성화 (Blender 4.5.3 LTS 최적화) import addon_utils # Add-on 활성화 (default_set=True로 설정 저장) try: addon_utils.enable("ImportLDraw-master", default_set=True) print(" LDraw Importer Add-on 활성화 완료 (설정 저장됨)") except Exception as e: print(f" Add-on 활성화 실패: {e}") return None # LDraw 환경 변수 설정 (경로 문제 해결) import os os.environ['LDRAWDIR'] = 'C:/LDraw' print(" LDraw 환경 변수 설정: C:/LDraw") # LDraw 파일 임포트 (올바른 operator 사용) bpy.ops.import_scene.importldraw(filepath=part_path) # 임포트된 객체 선택 imported_objects = [obj for obj in bpy.context.scene.objects if obj.type == 'MESH'] if not imported_objects: print(" LDraw 파일에서 메시를 찾을 수 없습니다") return None # 모든 메시를 하나의 객체로 결합 if len(imported_objects) > 1: bpy.context.view_layer.objects.active = imported_objects[0] bpy.ops.object.select_all(action='DESELECT') for obj in imported_objects: obj.select_set(True) bpy.ops.object.join() part_object = bpy.context.active_object part_object.name = "LEGOPart" print(f" LDraw 부품 로드 성공: {part_object.name}") return part_object except Exception as e: print(f" LDraw 로드 실패: {e}") return None def apply_random_material(part_object): """랜덤 재질 적용""" material = bpy.data.materials.new(name="LEGOMaterial") material.use_nodes = True nodes = material.node_tree.nodes nodes.clear() bsdf = nodes.new(type='ShaderNodeBsdfPrincipled') output = nodes.new(type='ShaderNodeOutputMaterial') material.node_tree.links.new(bsdf.outputs['BSDF'], output.inputs['Surface']) # 랜덤 색상 colors = [ (0.8, 0.1, 0.1, 1.0), # 빨강 (0.1, 0.3, 0.8, 1.0), # 파랑 (0.1, 0.7, 0.2, 1.0), # 초록 (0.9, 0.8, 0.1, 1.0), # 노랑 (0.95, 0.95, 0.95, 1.0) # 흰색 ] color = random.choice(colors) bsdf.inputs['Base Color'].default_value = color bsdf.inputs['Metallic'].default_value = 0.0 bsdf.inputs['Roughness'].default_value = 0.3 if part_object.data.materials: part_object.data.materials[0] = material else: part_object.data.materials.append(material) print(f" 재질 적용 완료: {color}") return color def render_image(output_path): """이미지 렌더링""" bpy.context.scene.render.filepath = output_path bpy.ops.render.render(write_still=True) print(f" 렌더링 완료: {output_path}") def main(): """메인 실행 함수""" print(" BrickBox Blender 테스트 렌더링 시작") # 출력 디렉토리 생성 output_dir = "./output/test" os.makedirs(output_dir, exist_ok=True) # 씬 초기화 clear_scene() # 렌더링 설정 setup_render_settings() setup_camera() setup_lighting() # LDraw 부품 로드 part_path = "C:/LDraw/parts/3001.dat" part_object = load_ldraw_part(part_path) if not part_object: print(" 부품 로드 실패") return # 랜덤 재질 적용 color = apply_random_material(part_object) # 랜덤 회전 적용 rotation_x = random.uniform(0, 2 * math.pi) rotation_y = random.uniform(0, 2 * math.pi) rotation_z = random.uniform(0, 2 * math.pi) part_object.rotation_euler = (rotation_x, rotation_y, rotation_z) print(f" 회전 적용: ({math.degrees(rotation_x):.1f}°, {math.degrees(rotation_y):.1f}°, {math.degrees(rotation_z):.1f}°)") # 렌더링 output_path = os.path.join(output_dir, "test_3001.png") render_image(output_path) print(" 테스트 렌더링 완료!") print(f"[DIR] 출력 파일: {output_path}") if __name__ == "__main__": main() 