#!/usr/bin/env python3 """ lego_parts_images 버킷 상태 확인 및 테스트 """ import os import sys from supabase import create_client, Client def main(): """메인 함수""" print("lego_parts_images bucket check") print("=" * 50) # Supabase 설정 supabase_url = os.getenv('VITE_SUPABASE_URL', 'https://npferbxuxocbfnfbpcnz.supabase.co') supabase_key = os.getenv('VITE_SUPABASE_ANON_KEY', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5wZmVyYnh1eG9jYmZuZmJwY256Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk0NzQ5ODUsImV4cCI6MjA3NTA1MDk4NX0.eqKQh_o1k2VmP-_v__gUMHVOgvdIzml-zDhZyzfxUmk') try: supabase = create_client(supabase_url, supabase_key) print("[PASS] Supabase client created successfully") # 1. 버킷 목록 확인 print("\nBucket list check...") buckets = supabase.storage.list_buckets() bucket_names = [bucket.name for bucket in buckets] print(f"Available buckets: {bucket_names}") # 2. lego_parts_images 버킷 확인 if 'lego_parts_images' in bucket_names: print("\n[SUCCESS] lego_parts_images bucket found!") # 기존 파일 목록 확인 try: files = supabase.storage.from_('lego_parts_images').list() print(f"Existing files: {len(files)}") # lego_sets_images 폴더 확인 try: set_files = supabase.storage.from_('lego_parts_images').list('lego_sets_images') print(f"lego_sets_images folder files: {len(set_files)}") for file_info in set_files: print(f" - {file_info.get('name', 'unknown')} ({file_info.get('size', 0)} bytes)") except Exception as e: print(f"lego_sets_images folder access failed: {e}") except Exception as e: print(f"File list query failed: {e}") # 3. 테스트 업로드 print("\nTest upload attempt...") test_data = b"Test set image data" test_path = "lego_sets_images/test_set.webp" try: result = supabase.storage.from_('lego_parts_images').upload( test_path, test_data, file_options={"content-type": "image/webp", "upsert": "true"} ) if hasattr(result, 'error') and result.error: print(f"[FAIL] Upload failed: {result.error}") else: print("[PASS] Upload successful!") # 공개 URL 생성 url_data = supabase.storage.from_('lego_parts_images').get_public_url(test_path) public_url = url_data.publicUrl if hasattr(url_data, 'publicUrl') else str(url_data) print(f"[INFO] Public URL: {public_url}") # 테스트 파일 삭제 supabase.storage.from_('lego_parts_images').remove([test_path]) print("[INFO] Test file deleted") except Exception as e: print(f"[FAIL] Upload failed: {e}") else: print("\n[ERROR] lego_parts_images bucket not found!") print("Please create 'lego_parts_images' bucket in Supabase dashboard.") except Exception as e: print(f"[ERROR] 확인 실패: {e}") if __name__ == "__main__": main() 