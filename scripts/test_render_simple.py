#!/usr/bin/env python3 """ 간단한 렌더링 테스트 스크립트 (유니코드 문제 해결) """ import os import sys from pathlib import Path # 프로젝트 루트를 Python 경로에 추가 project_root = Path(__file__).parent.parent sys.path.append(str(project_root)) def test_render_with_supabase(): """Supabase 연결 테스트와 함께 간단한 렌더링 테스트""" print("Simple render test starting...") # 환경 변수 로드 try: from dotenv import load_dotenv env_file = project_root / '.env' if env_file.exists(): print(f"Environment file found: {env_file}") load_dotenv(env_file, override=True) else: print(f"Environment file not found: {env_file}") return False except Exception as e: print(f"Environment variable load failed: {e}") return False # Supabase 모듈 확인 try: from supabase import create_client print("Supabase module available") except ImportError as e: print(f"Supabase module missing: {e}") return False # 환경 변수 확인 url = os.getenv('VITE_SUPABASE_URL') or os.getenv('SUPABASE_URL') key = os.getenv('SUPABASE_SERVICE_ROLE') or os.getenv('SUPABASE_KEY') or os.getenv('VITE_SUPABASE_ANON_KEY') print("Environment variables check:") print(f" - URL: {'Set' if url else 'Not set'}") print(f" - KEY: {'Set' if key else 'Not set'}") if not url or not key: print("Supabase URL or KEY is missing") return False # Supabase 클라이언트 생성 try: print("Creating Supabase client...") supabase = create_client(url, key) print("Supabase client created successfully") except Exception as e: print(f"Supabase client creation failed: {e}") return False # 연결 테스트 try: print("Testing Supabase connection...") buckets = supabase.storage.list_buckets() bucket_names = [b.name for b in buckets] if buckets else [] print(f"Available buckets: {bucket_names}") if 'lego-synthetic' in bucket_names: print("lego-synthetic bucket found") else: print("lego-synthetic bucket not found") print(f"Available buckets: {bucket_names}") return False # 업로드 테스트 print("Testing upload...") test_data = b"test data for render script" test_path = "test/render_test.txt" result = supabase.storage.from_('lego-synthetic').upload( test_path, test_data, file_options={ "content-type": "text/plain", "upsert": "true" } ) if hasattr(result, 'error') and result.error: print(f"Upload test failed: {result.error}") return False else: print("Upload test successful") # 테스트 파일 삭제 try: supabase.storage.from_('lego-synthetic').remove([test_path]) print("Test file deleted successfully") except Exception as delete_err: print(f"Test file deletion failed: {delete_err}") return True except Exception as test_err: print(f"Connection test failed: {test_err}") return False if __name__ == '__main__': success = test_render_with_supabase() if success: print("\nSimple render test SUCCESS!") print("Supabase connection is working properly.") print("The render script should now work with proper Supabase uploads.") else: print("\nSimple render test FAILED!") print("Please check the Supabase configuration.") sys.exit(1) 