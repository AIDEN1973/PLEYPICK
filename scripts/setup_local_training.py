#!/usr/bin/env python3 """ BrickBox ë¡œì»¬ í•™ìŠµ í™˜ê²½ ì„¤ì • ìŠ¤í¬ë¦½íŠ¸ ë¡œì»¬ PCì—ì„œ YOLO í•™ìŠµì„ ìœ„í•œ í™˜ê²½ì„ ì„¤ì •í•©ë‹ˆë‹¤. """ import os import sys import subprocess import platform from pathlib import Path def check_python_version(): """Python ë²„ì „ í™•ì¸""" version = sys.version_info if version.major < 3 or (version.major == 3 and version.minor < 8): print(" Python 3.8 ì´ìƒì´ í•„ìš”í•©ë‹ˆë‹¤.") return False print(f" Python ë²„ì „: {version.major}.{version.minor}.{version.micro}") return True def check_gpu_availability(): """GPU ì‚¬ìš© ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸""" try: import torch if torch.cuda.is_available(): gpu_count = torch.cuda.device_count() gpu_name = torch.cuda.get_device_name(0) print(f" GPU ì‚¬ìš© ê°€ëŠ¥: {gpu_name} ({gpu_count}ê°œ)") return True else: print(" GPUë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. CPUë¡œ í•™ìŠµí•©ë‹ˆë‹¤.") return False except ImportError: print(" PyTorchê°€ ì„¤ì¹˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.") return False def install_requirements(): """í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜""" print(" í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì¤‘...") requirements = [ "ultralytics>=8.0.0", "torch>=1.9.0", "torchvision>=0.10.0", "supabase>=1.0.0", "pyyaml>=6.0", "opencv-python>=4.5.0", "pillow>=8.0.0", "matplotlib>=3.3.0", "seaborn>=0.11.0", "pandas>=1.3.0", "numpy>=1.21.0" ] for package in requirements: try: print(f"ì„¤ì¹˜ ì¤‘: {package}") subprocess.check_call([sys.executable, "-m", "pip", "install", package]) print(f" {package} ì„¤ì¹˜ ì™„ë£Œ") except subprocess.CalledProcessError as e: print(f" {package} ì„¤ì¹˜ ì‹¤íŒ¨: {e}") return False return True def create_directories(): """í•„ìš”í•œ ë””ë ‰í† ë¦¬ ìƒì„±""" print("[DIR] ë””ë ‰í† ë¦¬ êµ¬ì¡° ìƒì„± ì¤‘...") directories = [ "data/synthetic", "data/ldraw", "data/parts", "data/materials", "data/colors", "runs/train", "runs/val", "runs/predict", "models", "logs" ] for directory in directories: Path(directory).mkdir(parents=True, exist_ok=True) print(f" {directory} ìƒì„±") return True def create_config_files(): """ì„¤ì • íŒŒì¼ ìƒì„±""" print("âš™ï¸ ì„¤ì • íŒŒì¼ ìƒì„± ì¤‘...") # .env íŒŒì¼ ìƒì„± env_content = """# BrickBox ë¡œì»¬ í•™ìŠµ í™˜ê²½ ì„¤ì • VITE_SUPABASE_URL=your_supabase_url_here VITE_SUPABASE_ANON_KEY=your_supabase_anon_key_here # ë¡œì»¬ í•™ìŠµ ì„¤ì • LOCAL_TRAINING_ENABLED=true DEFAULT_DEVICE=auto DEFAULT_EPOCHS=100 DEFAULT_BATCH_SIZE=16 DEFAULT_IMG_SIZE=640 # GPU ì„¤ì • CUDA_VISIBLE_DEVICES=0 """ with open(".env", "w", encoding="utf-8") as f: f.write(env_content) print(" .env íŒŒì¼ ìƒì„±") # ë¡œì»¬ í•™ìŠµ ì„¤ì • íŒŒì¼ config_content = """# ë¡œì»¬ í•™ìŠµ ì„¤ì • training: default_epochs: 100 default_batch_size: 16 default_img_size: 640 default_device: auto # GPU ì„¤ì • gpu: enabled: true device_count: 1 memory_fraction: 0.8 # ë°ì´í„°ì…‹ ì„¤ì • dataset: path: "data/synthetic" train_split: 0.8 val_split: 0.1 test_split: 0.1 # ëª¨ë¸ ì„¤ì • model: architecture: "yolo11n-seg" pretrained: true freeze_backbone: false # ìµœì í™” ì„¤ì • optimization: learning_rate: 0.01 weight_decay: 0.0005 momentum: 0.937 scheduler: "cosine" # ì¦ê°• ì„¤ì • augmentation: mosaic: 1.0 mixup: 0.0 copy_paste: 0.0 degrees: 0.0 translate: 0.1 scale: 0.5 shear: 0.0 perspective: 0.0 flipud: 0.0 fliplr: 0.5 """ with open("local_training_config.yaml", "w", encoding="utf-8") as f: f.write(config_content) print(" local_training_config.yaml ìƒì„±") return True def create_training_script(): """í•™ìŠµ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±""" print("ğŸ“ í•™ìŠµ ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ì¤‘...") script_content = '''#!/usr/bin/env python3 """ BrickBox ë¡œì»¬ í•™ìŠµ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸ """ import os import sys import yaml from pathlib import Path # í”„ë¡œì íŠ¸ ë£¨íŠ¸ë¥¼ Python ê²½ë¡œì— ì¶”ê°€ project_root = Path(__file__).parent.parent sys.path.insert(0, str(project_root)) from scripts.local_yolo_training import LocalYOLOTrainer def load_config(): """ì„¤ì • íŒŒì¼ ë¡œë“œ""" config_path = project_root / "local_training_config.yaml" if config_path.exists(): with open(config_path, 'r', encoding='utf-8') as f: return yaml.safe_load(f) return {} def main(): """ë©”ì¸ í•¨ìˆ˜""" print(" BrickBox ë¡œì»¬ í•™ìŠµ ì‹œì‘") # ì„¤ì • ë¡œë“œ config = load_config() training_config = config.get('training', {}) # í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ supabase_url = os.getenv('VITE_SUPABASE_URL') supabase_key = os.getenv('VITE_SUPABASE_ANON_KEY') if not supabase_url or not supabase_key: print(" Supabase í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.") print(" .env íŒŒì¼ì„ í™•ì¸í•˜ê³  VITE_SUPABASE_URLê³¼ VITE_SUPABASE_ANON_KEYë¥¼ ì„¤ì •í•˜ì„¸ìš”.") return False # í•™ìŠµ ì„¤ì • config_dict = { 'epochs': training_config.get('default_epochs', 100), 'batch_size': training_config.get('default_batch_size', 16), 'imgsz': training_config.get('default_img_size', 640), 'device': training_config.get('default_device', 'auto') } # í•™ìŠµ ì‹¤í–‰ trainer = LocalYOLOTrainer(supabase_url, supabase_key) success = trainer.run_training('latest', config_dict) if success: print(" ë¡œì»¬ í•™ìŠµ ì™„ë£Œ!") return True else: print(" ë¡œì»¬ í•™ìŠµ ì‹¤íŒ¨!") return False if __name__ == "__main__": success = main() sys.exit(0 if success else 1) ''' script_path = Path("scripts/run_local_training.py") with open(script_path, "w", encoding="utf-8") as f: f.write(script_content) # ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬ (Unix ì‹œìŠ¤í…œ) if platform.system() != "Windows": os.chmod(script_path, 0o755) print(" run_local_training.py ìƒì„±") return True def main(): """ë©”ì¸ ì„¤ì • í•¨ìˆ˜""" print(" BrickBox ë¡œì»¬ í•™ìŠµ í™˜ê²½ ì„¤ì • ì‹œì‘") print("=" * 50) # 1. Python ë²„ì „ í™•ì¸ if not check_python_version(): return False # 2. GPU í™•ì¸ check_gpu_availability() # 3. í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜ if not install_requirements(): print(" íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì‹¤íŒ¨") return False # 4. ë””ë ‰í† ë¦¬ ìƒì„± if not create_directories(): print(" ë””ë ‰í† ë¦¬ ìƒì„± ì‹¤íŒ¨") return False # 5. ì„¤ì • íŒŒì¼ ìƒì„± if not create_config_files(): print(" ì„¤ì • íŒŒì¼ ìƒì„± ì‹¤íŒ¨") return False # 6. í•™ìŠµ ìŠ¤í¬ë¦½íŠ¸ ìƒì„± if not create_training_script(): print(" í•™ìŠµ ìŠ¤í¬ë¦½íŠ¸ ìƒì„± ì‹¤íŒ¨") return False print("=" * 50) print(" ë¡œì»¬ í•™ìŠµ í™˜ê²½ ì„¤ì • ì™„ë£Œ!") print("\n ë‹¤ìŒ ë‹¨ê³„:") print("1. .env íŒŒì¼ì—ì„œ Supabase ì„¤ì •ì„ ì…ë ¥í•˜ì„¸ìš”") print("2. ë°ì´í„°ì…‹ì„ data/synthetic/ ë””ë ‰í† ë¦¬ì— ì¤€ë¹„í•˜ì„¸ìš”") print("3. ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ í•™ìŠµì„ ì‹œì‘í•˜ì„¸ìš”:") print(" python scripts/run_local_training.py") print("\n ë˜ëŠ” ëŒ€ì‹œë³´ë“œì—ì„œ 'í•™ìŠµ ì‹œì‘' ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”!") return True if __name__ == "__main__": success = main() sys.exit(0 if success else 1) 