#!/usr/bin/env python3 """ lego_parts_images 버킷 생성 및 RLS 정책 설정 """ import os import sys from supabase import create_client, Client def main(): """메인 함수""" print("Creating lego_parts_images bucket") print("=" * 50) # Supabase 설정 supabase_url = os.getenv('VITE_SUPABASE_URL', 'https://npferbxuxocbfnfbpcnz.supabase.co') supabase_key = os.getenv('VITE_SUPABASE_ANON_KEY', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5wZmVyYnh1eG9jYmZuZmJwY256Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk0NzQ5ODUsImV4cCI6MjA3NTA1MDk4NX0.eqKQh_o1k2VmP-_v__gUMHVOgvdIzml-zDhZyzfxUmk') try: supabase = create_client(supabase_url, supabase_key) print("[PASS] Supabase client created successfully") # 1. 기존 버킷 목록 확인 print("\nChecking existing buckets...") buckets = supabase.storage.list_buckets() bucket_names = [bucket.name for bucket in buckets] print(f"Existing buckets: {bucket_names}") # 2. lego_parts_images 버킷이 없으면 생성 if 'lego_parts_images' not in bucket_names: print("\nCreating lego_parts_images bucket...") try: # 버킷 생성 (공개 버킷으로 설정) result = supabase.storage.create_bucket( 'lego_parts_images', options={ 'public': True, 'file_size_limit': 52428800, # 50MB 'allowed_mime_types': ['image/*'] } ) if hasattr(result, 'error') and result.error: print(f"[FAIL] Bucket creation failed: {result.error}") return False else: print("[PASS] lego_parts_images bucket created successfully!") except Exception as e: print(f"[FAIL] Bucket creation failed: {e}") return False else: print("[INFO] lego_parts_images bucket already exists") # 3. 버킷 상태 확인 print("\nVerifying bucket...") try: # 테스트 파일 업로드 test_data = b"Test image data" test_path = "lego_sets_images/test.webp" result = supabase.storage.from_('lego_parts_images').upload( test_path, test_data, file_options={"content-type": "image/webp", "upsert": "true"} ) if hasattr(result, 'error') and result.error: print(f"[FAIL] Test upload failed: {result.error}") return False else: print("[PASS] Test upload successful!") # 공개 URL 생성 url_data = supabase.storage.from_('lego_parts_images').get_public_url(test_path) public_url = url_data.publicUrl if hasattr(url_data, 'publicUrl') else str(url_data) print(f"[INFO] Public URL: {public_url}") # 테스트 파일 삭제 supabase.storage.from_('lego_parts_images').remove([test_path]) print("[INFO] Test file deleted") print("\n[SUCCESS] lego_parts_images bucket is ready!") print("You can now upload LEGO set images to lego_parts_images/lego_sets_images/") except Exception as e: print(f"[FAIL] Bucket verification failed: {e}") return False except Exception as e: print(f"[ERROR] Setup failed: {e}") return False if __name__ == "__main__": main() 