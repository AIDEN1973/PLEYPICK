#!/usr/bin/env python3 """ BrickBox 완전 파이프라인 실행 스크립트 렌더링 → 데이터셋 변환 → 학습 준비까지 자동화 """ import os import sys import subprocess import time from pathlib import Path from datetime import datetime def run_command(command, description): """명령어 실행 및 결과 출력""" print(f"\n {description}...") print(f"명령어: {command}") try: result = subprocess.run(command, shell=True, capture_output=True, text=True, encoding='utf-8') if result.returncode == 0: print(f" {description} 완료") if result.stdout: print(f"출력: {result.stdout}") else: print(f" {description} 실패") print(f"에러: {result.stderr}") return False except Exception as e: print(f" {description} 실행 중 오류: {e}") return False return True def check_prerequisites(): """필수 조건 확인""" print(" 필수 조건 확인...") # Blender 확인 if not Path("scripts/render_ldraw_to_supabase.py").exists(): print(" 렌더링 스크립트를 찾을 수 없습니다") return False # 데이터셋 변환 스크립트 확인 if not Path("scripts/prepare_training_dataset.py").exists(): print(" 데이터셋 변환 스크립트를 찾을 수 없습니다") return False print(" 모든 필수 조건 충족") return True def run_rendering_phase(): """1단계: 렌더링 실행""" print("\n" + "="*50) print(" 1단계: 렌더링 실행") print("="*50) # 렌더링 명령어 (예시 - 실제 명령어로 수정 필요) render_command = "python scripts/render_ldraw_to_supabase.py" if not run_command(render_command, "렌더링 실행"): return False # 렌더링 결과 확인 output_dir = Path("output/synthetic") if not output_dir.exists(): print(" 렌더링 출력 폴더가 생성되지 않았습니다") return False # 생성된 샘플 수 확인 sample_count = 0 for element_dir in output_dir.iterdir(): if element_dir.is_dir(): sample_count += len(list(element_dir.glob("*.webp"))) print(f" 렌더링 완료: {sample_count}개 샘플 생성") return True def run_dataset_conversion(): """2단계: 데이터셋 변환""" print("\n" + "="*50) print(" 2단계: 데이터셋 변환") print("="*50) if not run_command("python scripts/prepare_training_dataset.py", "데이터셋 변환"): return False # 변환 결과 확인 dataset_dir = Path("data/brickbox_dataset") if not dataset_dir.exists(): print(" 데이터셋 폴더가 생성되지 않았습니다") return False # train/val 샘플 수 확인 train_count = len(list((dataset_dir / "images" / "train").glob("*.webp"))) val_count = len(list((dataset_dir / "images" / "val").glob("*.webp"))) print(f" 데이터셋 변환 완료: Train {train_count}개, Val {val_count}개") return True def check_training_readiness(): """3단계: 학습 준비 상태 확인""" print("\n" + "="*50) print(" 3단계: 학습 준비 상태 확인") print("="*50) dataset_dir = Path("data/brickbox_dataset") # 필수 파일 확인 required_files = [ "dataset.yaml", "images/train", "images/val", "labels/train", "labels/val" ] for file_path in required_files: if not (dataset_dir / file_path).exists(): print(f" 필수 파일/폴더 누락: {file_path}") return False # 샘플 수 확인 train_count = len(list((dataset_dir / "images" / "train").glob("*.webp"))) val_count = len(list((dataset_dir / "images" / "val").glob("*.webp"))) print(f" 학습 준비 완료!") print(f" - Train: {train_count}개") print(f" - Val: {val_count}개") print(f" - 총 샘플: {train_count + val_count}개") # 권장 샘플 수 확인 total_samples = train_count + val_count if total_samples < 1000: print(f" 권장 샘플 수 부족 (현재: {total_samples}, 권장: 1,000+)") print(" 더 많은 Element ID로 렌더링을 실행하세요") else: print(f" 충분한 샘플 수 (현재: {total_samples})") return True def main(): """메인 실행 함수""" print(" BrickBox 완전 파이프라인 시작") print(f"시작 시간: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}") start_time = time.time() # 0. 필수 조건 확인 if not check_prerequisites(): print(" 필수 조건 확인 실패") return False # 1. 렌더링 실행 if not run_rendering_phase(): print(" 렌더링 단계 실패") return False # 2. 데이터셋 변환 if not run_dataset_conversion(): print(" 데이터셋 변환 단계 실패") return False # 3. 학습 준비 상태 확인 if not check_training_readiness(): print(" 학습 준비 상태 확인 실패") return False # 완료 end_time = time.time() duration = end_time - start_time print("\n" + "="*50) print(" 완전 파이프라인 성공!") print("="*50) print(f"총 소요 시간: {duration:.2f}초") print(f"완료 시간: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}") print("\n다음 단계: YOLO 학습 실행") print("python scripts/hybrid_yolo_training_pipeline.py") return True if __name__ == "__main__": success = main() sys.exit(0 if success else 1) 