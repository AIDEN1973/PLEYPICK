#!/usr/bin/env python3 """ BrickBox Cron Jobs Setup 크론 작업 설정 (운영 환경용) """ import os import sys import json import subprocess from datetime import datetime def setup_cron_jobs(): """크론 작업 설정""" try: # 현재 디렉토리 경로 current_dir = os.getcwd() python_path = sys.executable # 크론 작업 정의 cron_jobs = [ # 성능 모니터링 (15분마다) f"*/15 * * * * cd {current_dir} && {python_path} scripts/performance_monitor.py >> logs/performance_monitor.log 2>&1", # 품질 체크 (30분마다) f"*/30 * * * * cd {current_dir} && {python_path} scripts/qa_worker.py --check-quality >> logs/quality_check.log 2>&1", # 재학습 평가 (1시간마다) f"0 * * * * cd {current_dir} && {python_path} scripts/retrain_trigger.py --evaluate >> logs/retrain_evaluation.log 2>&1", # 매니페스트 업데이트 (5분마다) f"*/5 * * * * cd {current_dir} && {python_path} scripts/manifest_manager.py --update >> logs/manifest_update.log 2>&1", # 큐 정리 (1시간마다) f"0 * * * * cd {current_dir} && {python_path} scripts/queue_manager.py --cleanup >> logs/queue_cleanup.log 2>&1", # 로그 로테이션 (매일 자정) f"0 0 * * * cd {current_dir} && {python_path} scripts/automated_pipeline.py --cleanup >> logs/cleanup.log 2>&1" ] # 크론 작업 파일 생성 cron_file = "brickbox_cron_jobs.txt" with open(cron_file, 'w') as f: for job in cron_jobs: f.write(job + '\n') print(f" 크론 작업 파일 생성: {cron_file}") print("다음 명령어로 크론 작업을 설치하세요:") print(f"crontab {cron_file}") return True except Exception as e: print(f" 크론 작업 설정 실패: {e}") return False def setup_systemd_services(): """systemd 서비스 설정 (Linux용)""" try: current_dir = os.getcwd() python_path = sys.executable # systemd 서비스 파일 생성 service_files = { 'brickbox-performance-monitor.service': f"""[Unit] Description=BrickBox Performance Monitor After=network.target [Service] Type=simple User=ubuntu WorkingDirectory={current_dir} ExecStart={python_path} scripts/performance_monitor.py Restart=always RestartSec=10 [Install] WantedBy=multi-user.target """, 'brickbox-automated-pipeline.service': f"""[Unit] Description=BrickBox Automated Pipeline After=network.target [Service] Type=simple User=ubuntu WorkingDirectory={current_dir} ExecStart={python_path} scripts/automated_pipeline.py Restart=always RestartSec=10 [Install] WantedBy=multi-user.target """ } for service_name, service_content in service_files.items(): with open(service_name, 'w') as f: f.write(service_content) print(f" systemd 서비스 파일 생성: {service_name}") print("다음 명령어로 서비스를 설치하세요:") print("sudo cp *.service /etc/systemd/system/") print("sudo systemctl daemon-reload") print("sudo systemctl enable brickbox-performance-monitor") print("sudo systemctl enable brickbox-automated-pipeline") print("sudo systemctl start brickbox-performance-monitor") print("sudo systemctl start brickbox-automated-pipeline") return True except Exception as e: print(f" systemd 서비스 설정 실패: {e}") return False def main(): """메인 실행""" try: print(" BrickBox 자동화 설정 시작") # 로그 디렉토리 생성 os.makedirs("logs", exist_ok=True) # 크론 작업 설정 if setup_cron_jobs(): print(" 크론 작업 설정 완료") # systemd 서비스 설정 if setup_systemd_services(): print(" systemd 서비스 설정 완료") print(" 자동화 설정 완료!") print("운영 환경에서 위의 명령어들을 실행하여 자동화를 활성화하세요.") except Exception as e: print(f" 자동화 설정 실패: {e}") if __name__ == "__main__": main() 