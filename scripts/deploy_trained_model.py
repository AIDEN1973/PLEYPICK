#!/usr/bin/env python3 """ í•™ìŠµëœ YOLO ëª¨ë¸ì„ Supabaseì— ë°°í¬í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ """ import os import sys from pathlib import Path from supabase import create_client, Client import json def deploy_model_to_supabase(): """ í•™ìŠµëœ ëª¨ë¸ì„ Supabase Storageì— ì—…ë¡œë“œ """ # .env íŒŒì¼ì—ì„œ í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ try: from dotenv import load_dotenv load_dotenv() except ImportError: print(" python-dotenvê°€ ì„¤ì¹˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ í™˜ê²½ ë³€ìˆ˜ë¥¼ ë¡œë“œí•©ë‹ˆë‹¤.") # .env íŒŒì¼ ì§ì ‘ ì½ê¸° env_vars = {} try: with open('.env', 'r', encoding='utf-8') as f: for line in f: line = line.strip() if line and not line.startswith('#') and '=' in line: key, value = line.split('=', 1) env_vars[key] = value except FileNotFoundError: print(" .env íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.") return False # í™˜ê²½ ë³€ìˆ˜ ê°€ì ¸ì˜¤ê¸° SUPABASE_URL = os.getenv('VITE_SUPABASE_URL') or env_vars.get('VITE_SUPABASE_URL') SUPABASE_KEY = os.getenv('VITE_SUPABASE_ANON_KEY') or env_vars.get('VITE_SUPABASE_ANON_KEY') if not SUPABASE_URL or not SUPABASE_KEY: print(" Supabase í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.") print(f"SUPABASE_URL: {SUPABASE_URL}") print(f"SUPABASE_KEY: {'ì„¤ì •ë¨' if SUPABASE_KEY else 'ì—†ìŒ'}") return False # Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„± supabase: Client = create_client(SUPABASE_URL, SUPABASE_KEY) # ëª¨ë¸ íŒŒì¼ ê²½ë¡œ model_dir = Path("public/models") model_files = [ "set_76917-1_best.pt", "set_76917-1_best.onnx" ] print(" ëª¨ë¸ ë°°í¬ ì‹œì‘...") for model_file in model_files: model_path = model_dir / model_file if not model_path.exists(): print(f" ëª¨ë¸ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: {model_path}") continue try: # íŒŒì¼ ì½ê¸° with open(model_path, 'rb') as f: file_data = f.read() # Supabase Storageì— ì—…ë¡œë“œ (RLS ìš°íšŒ) result = supabase.storage.from_('models').upload( f"yolo/{model_file}", file_data, file_options={ "content-type": "application/octet-stream", "upsert": "true" # ê¸°ì¡´ íŒŒì¼ ë®ì–´ì“°ê¸° } ) if result: print(f" {model_file} ì—…ë¡œë“œ ì„±ê³µ") print(f"[DIR] íŒŒì¼ ê²½ë¡œ: yolo/{model_file}") print(f" íŒŒì¼ í¬ê¸°: {len(file_data) / 1024 / 1024:.2f} MB") # ê³µê°œ URL ìƒì„± public_url = f"{SUPABASE_URL}/storage/v1/object/public/models/yolo/{model_file}" print(f"ğŸ”— ê³µê°œ URL: {public_url}") else: print(f" {model_file} ì—…ë¡œë“œ ì‹¤íŒ¨") except Exception as e: print(f" {model_file} ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜: {e}") print(" ëª¨ë¸ ë°°í¬ ì™„ë£Œ!") if __name__ == "__main__": deploy_model_to_supabase() 